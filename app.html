<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Value Network Analysis App | TeamTowers Hum√†. Mapea flujos de valor tangibles e intangibles en tu organizaci√≥n con nuestra herramienta visual interactiva.">
    <meta name="keywords" content="Value Network Analysis, VNA, mapeo de valor, TeamTowers Hum√†, Vilafranca del Pened√®s, flujos de valor, innovaci√≥n organizacional">
    <meta name="author" content="TeamTowers Hum√†">
    <meta name="robots" content="index, follow">
    <title>Value Network Analysis App | TeamTowers Hum√†</title>
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="Value Network Analysis App | TeamTowers Hum√†">
    <meta property="og:description" content="Mapea flujos de valor tangibles e intangibles en tu organizaci√≥n con nuestra herramienta visual interactiva.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://teamtowershuma.com/app">
    <meta property="og:image" content="https://raw.githubusercontent.com/asolache/Teamtowers/main/images/logoteamtowers.png">
    <meta property="og:locale" content="es_ES">
    <meta property="og:locale:alternate" content="ca_ES">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Value Network Analysis App | TeamTowers Hum√†">
    <meta name="twitter:description" content="Mapea flujos de valor tangibles e intangibles en tu organizaci√≥n">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/asolache/Teamtowers/main/images/logoteamtowers.png">
    
    <!-- vis-network CSS -->
    <link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet" type="text/css" />
    
    <style>
        :root {
            --primary: #1e3a8a; /* Azul TeamTowers */
            --secondary: #4f46e5; /* Azul m√°s claro */
            --accent: #8b5cf6; /* Morado TeamTowers */
            --dark: #0f172a;
            --light: #f8fafc;
            --gold: #f59e01;
            --success: #10b981;
            --warning: #fbbf24;
            --danger: #ef4444;
            --gray: #64748b;
            --border-radius: 12px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
            --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            --gradient-accent: linear-gradient(135deg, var(--accent) 0%, #7c3aed 100%);
            --gradient-dark: linear-gradient(135deg, var(--dark) 0%, #1e293b 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #fff;
            overflow-x: hidden;
        }
        
        /* Language Selector */
        .language-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 50px;
            padding: 5px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 5px;
        }
        
        .lang-btn {
            padding: 8px 16px;
            border: none;
            background: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .lang-btn.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 10px rgba(30, 58, 138, 0.4);
        }
        
        /* Header */
        header {
            background: var(--gradient-dark);
            color: white;
            padding: 20px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
            z-index: 10;
        }
        
        .header-logo {
            height: 60px;
            margin-bottom: 15px;
            filter: drop-shadow(0 4px 10px rgba(0,0,0,0.3));
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
        }
        
        .tagline {
            font-size: 1.4rem;
            opacity: 0.9;
            margin-bottom: 15px;
            font-weight: 300;
        }
        
        .integration-badge {
            display: inline-block;
            background: rgba(139, 92, 246, 0.2);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            margin-top: 10px;
            font-size: 0.95rem;
        }
        
        /* Main Content */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        @media (max-width: 992px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            height: fit-content;
            position: relative;
        }
        
        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--gradient-primary);
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }
        
        .panel h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            z-index: 10;
        }
        
        .panel h2::before {
            content: '';
            display: inline-block;
            width: 8px;
            height: 24px;
            background: var(--accent);
            border-radius: 4px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .input-group label::before {
            content: '‚Ä¢';
            color: var(--accent);
            font-size: 24px;
            line-height: 1;
        }
        
        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.2);
        }
        
        .input-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .btn-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.05rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transition: left 0.6s;
        }
        
        .btn:hover::after {
            left: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }
        
        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #0da27f 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #b91c1c 100%);
            color: white;
        }
        
        .btn-export {
            background: var(--gradient-accent);
            color: white;
            grid-column: span 2;
        }
        
        .visualization-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            position: relative;
        }
        
        .visualization-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--gradient-accent);
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }
        
        #network-container {
            width: 100%;
            height: 600px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: var(--light);
            position: relative;
        }
        
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
        }
        
        .empty-state svg {
            width: 140px;
            height: 140px;
            margin-bottom: 25px;
            color: var(--accent);
            opacity: 0.7;
        }
        
        .empty-state h3 {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--dark);
            font-weight: 700;
        }
        
        .empty-state p {
            max-width: 550px;
            margin-bottom: 30px;
            line-height: 1.7;
            font-size: 1.1rem;
        }
        
        .quick-add {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(255, 255, 255, 0) 100%);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid var(--success);
        }
        
        .quick-add h3 {
            color: var(--success);
            margin-bottom: 15px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quick-add h3::before {
            content: '‚ú®';
        }
        
        .quick-add p {
            margin-bottom: 15px;
            color: var(--gray);
            font-size: 0.95rem;
        }
        
        .quick-add-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .quick-add-btn:hover {
            background: #0da27f;
            transform: translateY(-2px);
        }
        
        .export-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid var(--accent);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.08) 0%, rgba(255, 255, 255, 0) 100%);
            border-radius: var(--border-radius);
        }
        
        .export-section h3 {
            color: var(--success);
            margin-bottom: 15px;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
        }
        
        .export-section h3::before {
            content: 'üì§';
            font-size: 1.4rem;
        }
        
        .export-section p {
            margin-bottom: 15px;
            color: var(--gray);
            line-height: 1.7;
            font-size: 1.05rem;
        }
        
        .export-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .integration-section {
            background: linear-gradient(135deg, var(--light) 0%, #eef2ff 100%);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-top: 25px;
            border-left: 4px solid var(--accent);
        }
        
        .integration-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
        }
        
        .integration-section h3::before {
            content: 'üîó';
            font-size: 1.4rem;
        }
        
        .next-step {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            margin: 30px 0;
            box-shadow: 0 6px 20px rgba(30, 58, 138, 0.3);
        }
        
        .next-step h3 {
            margin-bottom: 10px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1.5rem;
        }
        
        .next-step h3::before {
            content: '‚û°Ô∏è';
        }
        
        .next-step p {
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }
        
        .next-step a {
            display: inline-block;
            background: white;
            color: var(--primary);
            padding: 10px 25px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 700;
            margin-top: 10px;
            transition: var(--transition);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }
        
        .next-step a:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }
        
        .transaction-form {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.05) 0%, rgba(255, 255, 255, 0) 100%);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid var(--primary);
        }
        
        .transaction-form h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .transaction-form h3::before {
            content: 'üîÑ';
        }
        
        .form-row {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .form-row label {
            margin-bottom: 0;
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        .form-row select, 
        .form-row input {
            width: 100%;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }
        
        /* Footer */
        footer {
            background: var(--gradient-dark);
            color: rgba(255, 255, 255, 0.85);
            padding: 70px 20px 40px;
            margin-top: 70px;
        }
        
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 45px;
            max-width: 1300px;
            margin: 0 auto;
        }
        
        .footer-col h3 {
            color: white;
            font-size: 1.75rem;
            margin-bottom: 28px;
            position: relative;
            padding-bottom: 12px;
            font-weight: 700;
        }
        
        .footer-col h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 45px;
            height: 4px;
            background: var(--gradient-accent);
            border-radius: 2px;
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 14px;
        }
        
        .footer-links a {
            color: rgba(255, 255, 255, 0.75);
            text-decoration: none;
            transition: var(--transition);
            display: block;
            padding: 6px 0;
            font-size: 1.1rem;
            font-weight: 500;
            position: relative;
            padding-left: 22px;
        }
        
        .footer-links a::before {
            content: '‚Üí';
            position: absolute;
            left: 0;
            opacity: 0;
            transform: translateX(-8px);
            transition: all 0.3s ease;
            color: var(--accent);
        }
        
        .footer-links a:hover {
            color: white;
            transform: translateX(3px);
        }
        
        .footer-links a:hover::before {
            opacity: 1;
            transform: translateX(0);
        }
        
        .copyright {
            text-align: center;
            padding-top: 50px;
            margin-top: 50px;
            border-top: 1px solid rgba(255, 255, 255, 0.15);
            font-size: 1.05rem;
            color: rgba(255, 255, 255, 0.65);
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.7;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2.3rem;
            }
            
            .tagline {
                font-size: 1.2rem;
            }
            
            .panel {
                padding: 20px;
            }
            
            #network-container {
                height: 450px;
            }
            
            .btn-group {
                grid-template-columns: 1fr;
            }
            
            .export-buttons {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .language-selector {
                top: 15px;
                right: 15px;
                padding: 3px;
            }
            
            .header-logo {
                height: 50px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .tagline {
                font-size: 1.1rem;
            }
            
            .container {
                padding: 20px 15px;
            }
            
            .btn {
                padding: 12px 15px;
                font-size: 1rem;
            }
            
            #network-container {
                height: 350px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                grid-template-columns: 1fr;
            }
            
            .export-buttons {
                grid-template-columns: 1fr;
            }
        }
        
        /* Test Results Section */
        .test-results {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
            background: var(--light);
            display: none;
        }
        
        .test-pass {
            color: var(--success);
            font-weight: bold;
        }
        
        .test-fail {
            color: var(--danger);
            font-weight: bold;
        }
        
        .test-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid var(--accent);
        }
        
        .test-section h3 {
            color: var(--accent);
            margin-bottom: 15px;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
        }
        
        .test-section h3::before {
            content: 'üß™';
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 10000;
            animation: slideIn 0.3s, fadeOut 0.5s 2.5s forwards;
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #0da27f 100%);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #b91c1c 100%);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; transform: translateX(100%); }
        }
    </style>
</head>
<body>
    <!-- Language Selector -->
    <div class="language-selector">
        <button class="lang-btn active" data-lang="es">ES</button>
        <button class="lang-btn" data-lang="ca">CA</button>
    </div>
    
    <!-- Header -->
    <header>
        <div class="header-content">
            <img src="https://raw.githubusercontent.com/asolache/Teamtowers/main/images/logoteamtowers.png" alt="TeamTowers Hum√†" class="header-logo">
            <h1 class="lang" data-es="Value Network Analysis App" data-ca="Value Network Analysis App">Value Network Analysis App</h1>
            <p class="tagline lang" data-es="Mapea flujos de valor tangibles e intangibles en tu organizaci√≥n con nuestra herramienta visual interactiva" data-ca="Mapeja fluxos de valor tangibles i intangibles a la teva organitzaci√≥ amb la nostra eina visual interactiva">Mapea flujos de valor tangibles e intangibles en tu organizaci√≥n con nuestra herramienta visual interactiva</p>
            <div class="integration-badge lang" data-es="Parte del Sistema Integral de La Masia" data-ca="Part del Sistema Integral de La Masia">Parte del Sistema Integral de La Masia</div>
        </div>
    </header>
    
    <!-- Main Content -->
    <div class="container">
        <div class="app-container">
            <div class="panel">
                <h2 class="lang" data-es="‚ûï A√±adir Elementos" data-ca="‚ûï Afegir Elements">‚ûï A√±adir Elementos</h2>
                
                <div class="input-group">
                    <label class="lang" data-es="Nombre del Proyecto" data-ca="Nom del Projecte">Nombre del Proyecto</label>
                    <input type="text" id="project-name" placeholder="Ej: Proyecto MASIA" value="Proyecto MASIA">
                </div>
                
                <div class="input-group">
                    <label class="lang" data-es="Nuevo Rol" data-ca="Nou Rol">Nuevo Rol</label>
                    <input type="text" id="node-name" placeholder="Ej: Equipo de Marketing">
                </div>
                
                <div class="btn-group">
                    <button id="add-node" class="btn btn-primary">
                        <span>‚ú®</span> <span class="lang" data-es="A√±adir Rol" data-ca="Afegir Rol">A√±adir Rol</span>
                    </button>
                </div>
                
                <div class="transaction-form">
                    <h3 class="lang" data-es="Nueva Transacci√≥n" data-ca="Nova Transacci√≥">Nueva Transacci√≥n</h3>
                    <div class="form-row">
                        <label class="lang" data-es="De:" data-ca="De:">De:</label>
                        <select id="source-node">
                            <option class="lang" data-es="Selecciona un rol de origen" data-ca="Selecciona un rol d'origen">Selecciona un rol de origen</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label class="lang" data-es="Para:" data-ca="Per a:">Para:</label>
                        <select id="target-node">
                            <option class="lang" data-es="Selecciona un rol destino" data-ca="Selecciona un rol dest√≠">Selecciona un rol destino</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label class="lang" data-es="Tipo:" data-ca="Tipus:">Tipo:</label>
                        <select id="deliverable-type">
                            <option value="tangible" class="lang" data-es="Tangible (bienes, servicios)" data-ca="Tangible (b√©ns, serveis)">Tangible (bienes, servicios)</option>
                            <option value="intangible" class="lang" data-es="Intangible (confianza, conocimiento)" data-ca="Intangible (confian√ßa, coneixement)">Intangible (confianza, conocimiento)</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label class="lang" data-es="Entregable:" data-ca="Entregable:">Entregable:</label>
                        <input type="text" id="deliverable-name" placeholder="Ej: Informe de mercado">
                    </div>
                    <div class="btn-group" style="margin-top: 15px; grid-template-columns: 1fr;">
                        <button id="add-link" class="btn btn-primary">
                            <span>üîó</span> <span class="lang" data-es="A√±adir Transacci√≥n" data-ca="Afegir Transacci√≥">A√±adir Transacci√≥n</span>
                        </button>
                    </div>
                </div>
                
                <div class="quick-add">
                    <h3 class="lang" data-es="Comenzar R√°pido" data-ca="Comen√ßar R√†pid">Comenzar R√°pido</h3>
                    <p class="lang" data-es="A√±ade roles y transacciones de ejemplo para ver c√≥mo funciona el mapa de valor." data-ca="Afegeix rols i transaccions d'exemple per veure com funciona el mapa de valor.">A√±ade roles y transacciones de ejemplo para ver c√≥mo funciona el mapa de valor.</p>
                    <button id="quick-start" class="quick-add-btn">
                        <span>üöÄ</span> <span class="lang" data-es="A√±adir Ejemplo" data-ca="Afegir Exemple">A√±adir Ejemplo</span>
                    </button>
                </div>
                
                <div class="panel" style="margin-top: 25px;">
                    <h2 class="lang" data-es="üíæ Exportar Datos" data-ca="üíæ Exportar Dades">üíæ Exportar Datos</h2>
                    <div class="export-buttons">
                        <button id="export-json" class="btn btn-export">
                            <span>üìä</span> <span class="lang" data-es="Exportar JSON" data-ca="Exportar JSON">Exportar JSON</span>
                        </button>
                        <button id="export-roles-csv" class="btn btn-success">
                            <span>üë•</span> <span class="lang" data-es="Exportar Roles CSV" data-ca="Exportar Rols CSV">Exportar Roles CSV</span>
                        </button>
                        <button id="export-png" class="btn btn-warning">
                            <span>üñºÔ∏è</span> <span class="lang" data-es="Exportar PNG" data-ca="Exportar PNG">Exportar PNG</span>
                        </button>
                        <button id="reset-data" class="btn btn-danger">
                            <span>üóëÔ∏è</span> <span class="lang" data-es="Limpiar Datos" data-ca="Netejar Dades">Limpiar Datos</span>
                        </button>
                    </div>
                </div>
                
                <div class="export-section">
                    <h3 class="lang" data-es="Exportar Roles para Value Accounting App" data-ca="Exportar Rols per a App Comptabilitat de Valor">Exportar Roles para Value Accounting App</h3>
                    <p class="lang" data-es="Exporta los roles de tu mapa de valor como archivo CSV para importarlos directamente en la <a href='https://teamtowershuma.com/app_comptabilitat' target='_blank' style='color: var(--primary); font-weight: 600;'>App de Contabilidad de Valor</a>. Esto pre-poblar√° los roles disponibles al registrar entregables." data-ca="Exporta els rols del teu mapa de valor com a arxiu CSV per importar-los directament a l'<a href='https://teamtowershuma.com/app_comptabilitat' target='_blank' style='color: var(--primary); font-weight: 600;'>App de Comptabilitat de Valor</a>. Aix√≤ pre-omplir√† els rols disponibles en registrar entregables.">Exporta los roles de tu mapa de valor como archivo CSV para importarlos directamente en la <a href="https://teamtowershuma.com/app_comptabilitat" target="_blank" style="color: var(--primary); font-weight: 600;">App de Contabilidad de Valor</a>. Esto pre-poblar√° los roles disponibles al registrar entregables.</p>
                    <p class="lang" data-es="<strong>Formato del CSV:</strong> El archivo exportado contendr√° una columna 'Rol' con todos los roles/nodos de tu mapa de valor. Este formato es compatible con la importaci√≥n en la App de Contabilidad de Valor." data-ca="<strong>Format de l'CSV:</strong> L'arxiu exportat contindr√† una columna 'Rol' amb tots els rols/nodes del teu mapa de valor. Aquest format √©s compatible amb la importaci√≥ a l'App de Comptabilitat de Valor."><strong>Formato del CSV:</strong> El archivo exportado contendr√° una columna 'Rol' con todos los roles/nodos de tu mapa de valor. Este formato es compatible con la importaci√≥n en la App de Contabilidad de Valor.</p>
                </div>
                
                <div class="test-section">
                    <h3 class="lang" data-es="Ejecutar Pruebas" data-ca="Executar Proves">Ejecutar Pruebas</h3>
                    <p class="lang" data-es="Ejecuta pruebas autom√°ticas para verificar que la aplicaci√≥n funcione correctamente en tu navegador." data-ca="Executa proves autom√†tiques per verificar que l'aplicaci√≥ funcioni correctament al teu navegador.">Ejecuta pruebas autom√°ticas para verificar que la aplicaci√≥n funcione correctamente en tu navegador.</p>
                    <button id="run-tests" class="btn btn-warning" style="width: 100%;">
                        <span>üî¨</span> <span class="lang" data-es="Ejecutar Pruebas" data-ca="Executar Proves">Ejecutar Pruebas</span>
                    </button>
                    <div id="test-results" class="test-results"></div>
                </div>
                
                <div class="integration-section" style="margin-top: 25px;">
                    <h3 class="lang" data-es="Siguiente Paso: Value Accounting App" data-ca="Pas Seg√ºent: App Comptabilitat de Valor">Siguiente Paso: Value Accounting App</h3>
                    <p class="lang" data-es="Una vez hayas mapeado los flujos de valor y exportado los roles, contin√∫a en la <a href='https://teamtowershuma.com/app_comptabilitat' target='_blank' style='color: var(--primary); font-weight: 600;'>App de Contabilidad de Valor</a> para registrar entregables, asignar usuarios por rol y preparar para la tokenizaci√≥n." data-ca="Un cop hagis mapejat els fluxos de valor i exportat els rols, continua a l'<a href='https://teamtowershuma.com/app_comptabilitat' target='_blank' style='color: var(--primary); font-weight: 600;'>App de Comptabilitat de Valor</a> per registrar entregables, assignar usuaris per rol i preparar per a la tokenitzaci√≥.">Una vez hayas mapeado los flujos de valor y exportado los roles, contin√∫a en la <a href="https://teamtowershuma.com/app_comptabilitat" target="_blank" style="color: var(--primary); font-weight: 600;">App de Contabilidad de Valor</a> para registrar entregables, asignar usuarios por rol y preparar para la tokenizaci√≥n.</p>
                </div>
            </div>
            
            <div class="visualization-container">
                <h2>üó∫Ô∏è <span class="lang" data-es="Mapa de Valor Visual" data-ca="Mapa de Valor Visual">Mapa de Valor Visual</span></h2>
                <div id="network-container">
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        <h3 class="lang" data-es="No hay nodos en el mapa a√∫n" data-ca="No hi ha nodes al mapa encara">No hay nodos en el mapa a√∫n</h3>
                        <p class="lang" data-es="A√±ade roles y transacciones para visualizar tu mapa de valor. Usa el bot√≥n 'A√±adir Ejemplo' para ver un mapa de ejemplo." data-ca="Afegeix rols i transaccions per visualitzar el teu mapa de valor. Utilitza el bot√≥ 'Afegir Exemple' per veure un mapa d'exemple.">A√±ade roles y transacciones para visualizar tu mapa de valor. Usa el bot√≥n 'A√±adir Ejemplo' para ver un mapa de ejemplo.</p>
                    </div>
                </div>
                
                <div class="next-step">
                    <h3 class="lang" data-es="Exporta tus Roles para Continuar" data-ca="Exporta els teus Rols per Continuar">Exporta tus Roles para Continuar</h3>
                    <p class="lang" data-es="Una vez hayas creado tu mapa de valor, haz clic en 'Exportar Roles como CSV' para descargar un archivo compatible con la App de Contabilidad de Valor. Este archivo contiene todos los roles/nodos de tu mapa." data-ca="Un cop hagis creat el teu mapa de valor, fes clic a 'Exportar Rols com a CSV' per descarregar un arxiu compatible amb l'App de Comptabilitat de Valor. Aquest arxiu cont√© tots els rols/nodes del teu mapa.">Una vez hayas creado tu mapa de valor, haz clic en 'Exportar Roles como CSV' para descargar un archivo compatible con la App de Contabilidad de Valor. Este archivo contiene todos los roles/nodos de tu mapa.</p>
                    <a href="#export-section" class="lang" data-es="Ir a Exportar Roles" data-ca="Anar a Exportar Rols">Ir a Exportar Roles</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer>
        <div class="footer-grid">
            <div class="footer-col">
                <h3 class="lang" data-es="TeamTowers Hum√†" data-ca="TeamTowers Hum√†">TeamTowers Hum√†</h3>
                <p class="lang" data-es="De las torres humanas a las organizaciones humanas. Consultor√≠a estrat√©gica de RRHH con enfoque humanista desde Vilafranca del Pened√®s." data-ca="De les torres humanes a les organitzacions humanes. Consultoria estrat√®gica de RRHH amb enfocament humanista des de Vilafranca del Pened√®s.">De las torres humanas a las organizaciones humanas. Consultor√≠a estrat√©gica de RRHH con enfoque humanista desde Vilafranca del Pened√®s.</p>
            </div>
            <div class="footer-col">
                <h3 class="lang" data-es="Servicios" data-ca="Serveis">Servicios</h3>
                <ul class="footer-links">
                    <li><a href="https://teamtowershuma.com/" class="lang" data-es="TeamTowers" data-ca="TeamTowers">TeamTowers</a></li>
                    <li><a href="https://teamtowershuma.com/valor" class="lang" data-es="Value Network Analysis" data-ca="Value Network Analysis">Value Network Analysis</a></li>
                    <li><a href="https://teamtowershuma.com/coops" class="lang" data-es="Comunidades de Pr√°ctica" data-ca="Comunitats de Pr√†ctica">Comunidades de Pr√°ctica</a></li>
                    <li><a href="https://teamtowershuma.com/rrhh" class="lang" data-es="Business Partner RRHH" data-ca="Business Partner RRHH">Business Partner RRHH</a></li>
                    <li><a href="https://teamtowershuma.com/masia" class="lang" data-es="La Masia" data-ca="La Masia">La Masia</a></li>
                    <li><a href="https://teamtowershuma.com/sistema_integral" class="lang" data-es="Sistema Integral" data-ca="Sistema Integral">Sistema Integral</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3 class="lang" data-es="Apps del Ecosistema" data-ca="Apps de l'Ecosistema">Apps del Ecosistema</h3>
                <ul class="footer-links">
                    <li><a href="https://teamtowershuma.com/app" class="lang" data-es="App VNA" data-ca="App VNA">App VNA</a></li>
                    <li><a href="https://teamtowershuma.com/app_comptabilitat" class="lang" data-es="App Contabilidad de Valor" data-ca="App Comptabilitat de Valor">App Contabilidad de Valor</a></li>
                    <li><a href="https://teamtowershuma.com/app_coops" class="lang" data-es="App Comunidades de Pr√°ctica" data-ca="App Comunitats de Pr√†ctica">App Comunidades de Pr√°ctica</a></li>
                    <li><a href="https://teamtowershuma.com/tokenomics" class="lang" data-es="App Tokenomics" data-ca="App Tokenomics">App Tokenomics</a></li>
                    <li><a href="https://cursovna.netlify.app/" target="_blank" class="lang" data-es="Curso de VNA" data-ca="Curs de VNA">Curso de VNA</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3 class="lang" data-es="Contacto" data-ca="Contacte">Contacto</h3>
                <ul class="footer-links">
                    <li>Vilafranca del Pened√®s, Barcelona</li>
                    <li>+34 629 86 77 15</li>
                    <li>
                        <a href="mailto:asolache@mac.com" style="color: var(--accent); font-weight: 600;">
                            <span class="lang" data-es="Enviar mensaje" data-ca="Enviar missatge">Enviar mensaje</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://linkedin.com/in/alvarosolache" target="_blank" style="color: var(--accent); font-weight: 600;">LinkedIn</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="copyright">
            <p class="lang" data-es="¬© 2026 TeamTowers Hum√†. Todos los derechos reservados. Value Network Analysis App para mapear flujos de valor tangibles e intangibles en organizaciones." data-ca="¬© 2026 TeamTowers Hum√†. Tots els drets reservats. Value Network Analysis App per mapejar fluxos de valor tangibles i intangibles en organitzacions.">¬© 2026 TeamTowers Hum√†. Todos los derechos reservados. Value Network Analysis App para mapear flujos de valor tangibles e intangibles en organizaciones.</p>
        </div>
    </footer>
    
    <!-- vis-network JS -->
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    
    <script>
        // ========== TEST-DRIVEN DEVELOPMENT FRAMEWORK ==========
        const testSuite = {
            results: [],
            assert: {
                equals: function(actual, expected, testName) {
                    const passed = actual === expected;
                    this.results.push({
                        name: testName,
                        passed: passed,
                        actual: actual,
                        expected: expected
                    });
                    return passed;
                },
                truthy: function(actual, testName) {
                    const passed = !!actual;
                    this.results.push({
                        name: testName,
                        passed: passed,
                        actual: actual,
                        expected: 'truthy value'
                    });
                    return passed;
                },
                falsy: function(actual, testName) {
                    const passed = !actual;
                    this.results.push({
                        name: testName,
                        passed: passed,
                        actual: actual,
                        expected: 'falsy value'
                    });
                    return passed;
                },
                type: function(actual, expectedType, testName) {
                    const actualType = typeof actual;
                    const passed = actualType === expectedType;
                    this.results.push({
                        name: testName,
                        passed: passed,
                        actual: actualType,
                        expected: expectedType
                    });
                    return passed;
                }
            },
            runTests: function() {
                this.results = [];
                
                // Test 1: Network container exists
                this.assert.truthy(document.getElementById('network-container'), "Network container exists");
                
                // Test 2: Add node button exists
                this.assert.truthy(document.getElementById('add-node'), "Add node button exists");
                
                // Test 3: Add link button exists
                this.assert.truthy(document.getElementById('add-link'), "Add link button exists");
                
                // Test 4: Export JSON button exists
                this.assert.truthy(document.getElementById('export-json'), "Export JSON button exists");
                
                // Test 5: Export CSV button exists
                this.assert.truthy(document.getElementById('export-roles-csv'), "Export CSV button exists");
                
                // Test 6: Export PNG button exists
                this.assert.truthy(document.getElementById('export-png'), "Export PNG button exists");
                
                // Test 7: Reset button exists
                this.assert.truthy(document.getElementById('reset-data'), "Reset button exists");
                
                // Test 8: Quick start button exists
                this.assert.truthy(document.getElementById('quick-start'), "Quick start button exists");
                
                // Test 9: Initial state has no nodes
                this.assert.equals(vnaData.nodes.length, 0, "Initial state has no nodes");
                
                // Test 10: Initial state has no edges
                this.assert.equals(vnaData.edges.length, 0, "Initial state has no edges");
                
                // Test 11: Add a test node
                const testNodeName = "Test Node " + Date.now();
                document.getElementById('node-name').value = testNodeName;
                document.getElementById('add-node').click();
                this.assert.equals(vnaData.nodes.length, 1, "Adding a node increases node count");
                
                // Test 12: Verify node was added correctly
                const addedNode = vnaData.nodes.find(n => n.label === testNodeName);
                this.assert.truthy(addedNode, "Node was added to vnaData");
                this.assert.truthy(nodes.get(addedNode.id), "Node was added to vis-network dataset");
                
                // Test 13: Add a test edge
                if (vnaData.nodes.length >= 2) {
                    // Add second node if needed
                    const testNodeName2 = "Test Node 2 " + Date.now();
                    document.getElementById('node-name').value = testNodeName2;
                    document.getElementById('add-node').click();
                }
                
                // Set up edge form
                document.getElementById('source-node').value = vnaData.nodes[0].id;
                document.getElementById('target-node').value = vnaData.nodes[1].id;
                document.getElementById('deliverable-name').value = "Test Deliverable";
                document.getElementById('deliverable-type').value = "tangible";
                document.getElementById('add-link').click();
                
                this.assert.equals(vnaData.edges.length, 1, "Adding an edge increases edge count");
                
                // Test 14: Verify edge was added correctly
                const addedEdge = vnaData.edges.find(e => e.label === "Test Deliverable");
                this.assert.truthy(addedEdge, "Edge was added to vnaData");
                this.assert.truthy(edges.get(addedEdge.id), "Edge was added to vis-network dataset");
                
                // Test 15: Export roles CSV function exists
                this.assert.truthy(typeof exportRolesCSV === 'function', "exportRolesCSV function exists");
                
                // Test 16: Export JSON function exists
                this.assert.truthy(typeof exportJSON === 'function', "exportJSON function exists");
                
                // Test 17: Network is initialized
                this.assert.truthy(network !== null, "Network is initialized");
                
                // Test 18: Node selectors are updated
                const sourceOptions = document.getElementById('source-node').options.length;
                const targetOptions = document.getElementById('target-node').options.length;
                this.assert.equals(sourceOptions, vnaData.nodes.length + 1, "Source node selector has correct options");
                this.assert.equals(targetOptions, vnaData.nodes.length + 1, "Target node selector has correct options");
                
                // Clean up test data
                resetDataWithoutConfirmation();
                
                return this.results;
            },
            displayResults: function(results) {
                const testResultsDiv = document.getElementById('test-results');
                testResultsDiv.style.display = 'block';
                testResultsDiv.innerHTML = '';
                
                let passedCount = 0;
                let failedCount = 0;
                
                results.forEach(result => {
                    const resultDiv = document.createElement('div');
                    resultDiv.className = result.passed ? 'test-pass' : 'test-fail';
                    resultDiv.innerHTML = `[${result.passed ? '‚úì PASS' : '‚úó FAIL'}] ${result.name}<br/>` +
                        `   Expected: ${result.expected}<br/>` +
                        `   Actual: ${result.actual}`;
                    testResultsDiv.appendChild(resultDiv);
                    
                    if (result.passed) passedCount++;
                    else failedCount++;
                });
                
                // Summary
                const summary = document.createElement('div');
                summary.style.fontWeight = 'bold';
                summary.style.marginTop = '15px';
                summary.style.paddingTop = '10px';
                summary.style.borderTop = '1px solid #ddd';
                summary.innerHTML = `Resultados: ${passedCount} pasadas, ${failedCount} fallidas de ${results.length} pruebas`;
                testResultsDiv.appendChild(summary);
                
                // Alert summary
                if (failedCount === 0) {
                    showNotification(`‚úÖ ¬°Todas las pruebas pasaron! (${passedCount}/${results.length})\n\nLa aplicaci√≥n est√° funcionando correctamente en tu navegador.`, 'success');
                } else {
                    showNotification(`‚ö†Ô∏è Algunas pruebas fallaron (${failedCount}/${results.length}).\n\nRevisa los resultados en la secci√≥n de pruebas.`, 'error');
                }
            }
        };
        
        // ========== APPLICATION STATE AND FUNCTIONS ==========
        // Estado de la aplicaci√≥n
        let vnaData = {
            projectName: "Proyecto MASIA",
            nodes: [],
            edges: []
        };
        
        // vis-network variables
        let nodes = null;
        let edges = null;
        let network = null;
        let nextNodeId = 1;
        let nextEdgeId = 1;
        
        // Inicializaci√≥n cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar botones de idioma
            setupLanguageSelector();
            
            // Cargar datos guardados
            loadSavedData();
            
            // Inicializar la red
            initNetwork();
            
            // Configurar event listeners
            setupEventListeners();
            
            // Actualizar selectores de nodos
            updateNodeSelectors();
            
            // Mostrar notificaci√≥n de bienvenida
            setTimeout(() => {
                showNotification('¬°Bienvenido a la Value Network Analysis App! Usa "A√±adir Ejemplo" para ver un mapa de valor demostrativo.', 'success');
            }, 1000);
        });
        
        // Configurar selector de idioma
        function setupLanguageSelector() {
            const langButtons = document.querySelectorAll('.lang-btn');
            const translatableElements = document.querySelectorAll('[data-es], [data-ca]');
            
            // Establecer idioma inicial
            const userLang = navigator.language.startsWith('ca') ? 'ca' : 'es';
            setActiveLanguage(userLang);
            
            // Event listeners para botones de idioma
            langButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const selectedLang = this.getAttribute('data-lang');
                    setActiveLanguage(selectedLang);
                    
                    // Actualizar bot√≥n activo
                    langButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            function setActiveLanguage(lang) {
                translatableElements.forEach(element => {
                    if (element.hasAttribute(`data-${lang}`)) {
                        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                            element.placeholder = element.getAttribute(`data-${lang}`);
                        } else {
                            element.innerHTML = element.getAttribute(`data-${lang}`);
                        }
                    }
                });
                
                document.documentElement.setAttribute('lang', lang);
            }
        }
        
        // Inicializar la red de vis-network
        function initNetwork() {
            // Initialize the nodes and edges DataSet
            nodes = new vis.DataSet();
            edges = new vis.DataSet();
            
            // Get the container for the network
            const container = document.getElementById('network-container');
            
            // Network options
            const options = {
                nodes: {
                    shape: 'dot',
                    size: 25,
                    font: {
                        size: 16,
                        face: 'Tahoma'
                    },
                    borderWidth: 2,
                    shadow: true
                },
                edges: {
                    width: 2,
                    color: {
                        color: '#1e3a8a',
                        highlight: '#4f46e5'
                    },
                    font: {
                        size: 12,
                        align: 'middle',
                        background: 'white',
                        strokeWidth: 2,
                        strokeColor: '#ffffff'
                    },
                    smooth: {
                        enabled: true,
                        type: "continuous",
                        forceDirection: "none",
                        roundness: 0.5
                    },
                    shadow: true,
                    arrows: {
                        to: { enabled: true, scaleFactor: 0.7 }
                    }
                },
                physics: {
                    enabled: true,
                    solver: 'forceAtlas2Based',
                    stabilization: {
                        enabled: true,
                        iterations: 100,
                        updateInterval: 25
                    }
                },
                interaction: {
                    hover: true,
                    tooltipDelay: 200
                }
            };
            
            // Initialize the network
            network = new vis.Network(container, { nodes: nodes, edges: edges }, options);
            
            // Set up event listeners for the network
            network.on('click', function(params) {
                if (params.nodes.length > 0) {
                    const nodeId = params.nodes[0];
                    const node = nodes.get(nodeId);
                    showNotification(`Nodo seleccionado: ${node.label}`, 'success');
                }
                
                if (params.edges.length > 0) {
                    const edgeId = params.edges[0];
                    const edge = edges.get(edgeId);
                    const typeText = edge.type === 'tangible' ? 'Tangible' : 'Intangible';
                    showNotification(`Transacci√≥n: ${edge.label}\nTipo: ${typeText}`, 'success');
                }
            });
        }
        
        // Configurar event listeners
        function setupEventListeners() {
            // A√±adir nodo
            document.getElementById('add-node').addEventListener('click', addNode);
            
            // A√±adir enlace
            document.getElementById('add-link').addEventListener('click', addLink);
            
            // Exportar JSON
            document.getElementById('export-json').addEventListener('click', exportJSON);
            
            // Exportar Roles CSV
            document.getElementById('export-roles-csv').addEventListener('click', exportRolesCSV);
            
            // Exportar PNG
            document.getElementById('export-png').addEventListener('click', exportPNG);
            
            // Limpiar datos
            document.getElementById('reset-data').addEventListener('click', resetData);
            
            // Quick start
            document.getElementById('quick-start').addEventListener('click', quickStartVNA);
            
            // Ejecutar pruebas
            document.getElementById('run-tests').addEventListener('click', runTests);
            
            // Cambiar nombre del proyecto
            document.getElementById('project-name').addEventListener('change', function() {
                vnaData.projectName = this.value || "Proyecto MASIA";
                saveData();
            });
        }
        
        // A√±adir nodo/rol
        function addNode() {
            const nodeName = document.getElementById('node-name').value.trim();
            
            if (!nodeName) {
                showNotification('Por favor, introduce un nombre para el rol', 'error');
                return;
            }
            
            // Verificar si el nodo ya existe
            const existingNode = vnaData.nodes.find(n => n.label.toLowerCase() === nodeName.toLowerCase());
            if (existingNode) {
                showNotification(`El rol "${nodeName}" ya existe`, 'error');
                return;
            }
            
            // Crear nuevo nodo
            const nodeId = `node-${nextNodeId++}`;
            const newNode = {
                id: nodeId,
                label: nodeName,
                group: vnaData.nodes.length % 5 + 1 // Cycle through 5 groups
            };
            
            // Add to data structures
            vnaData.nodes.push(newNode);
            nodes.add(newNode);
            
            // Guardar y actualizar
            saveData();
            updateNodeSelectors();
            
            // Limpiar formulario
            document.getElementById('node-name').value = '';
            
            // Feedback al usuario
            showNotification(`Rol "${nodeName}" a√±adido correctamente`, 'success');
        }
        
        // A√±adir enlace/transacci√≥n
        function addLink() {
            const sourceNode = document.getElementById('source-node').value;
            const targetNode = document.getElementById('target-node').value;
            const deliverableName = document.getElementById('deliverable-name').value.trim();
            const deliverableType = document.getElementById('deliverable-type').value;
            
            if (!sourceNode || !targetNode || sourceNode === "default" || targetNode === "default") {
                showNotification('Selecciona un rol origen y un rol destino', 'error');
                return;
            }
            
            if (!deliverableName) {
                showNotification('Introduce un nombre para el entregable', 'error');
                return;
            }
            
            if (sourceNode === targetNode) {
                showNotification('El rol origen y destino no pueden ser el mismo', 'error');
                return;
            }
            
            // Verificar si la transacci√≥n ya existe entre estos nodos con el mismo entregable
            const existingEdge = vnaData.edges.find(e => 
                e.from === sourceNode && 
                e.to === targetNode && 
                e.label === deliverableName
            );
            
            if (existingEdge) {
                showNotification(`La transacci√≥n de "${getNodeLabelById(sourceNode)}" a "${getNodeLabelById(targetNode)}" con el entregable "${deliverableName}" ya existe`, 'error');
                return;
            }
            
            // Create edge ID
            const edgeId = `edge-${nextEdgeId++}`;
            
            // Determine edge appearance based on type
            let edgeColor, edgeDashes;
            if (deliverableType === 'tangible') {
                edgeColor = { color: '#1e3a8a', highlight: '#4f46e5' };
                edgeDashes = false;
            } else {
                edgeColor = { color: '#0ea5e9', highlight: '#0284c7' };
                edgeDashes = [5, 5];
            }
            
            // Count edges between these nodes to adjust roundness
            const edgesBetweenNodes = vnaData.edges.filter(e => 
                (e.from === sourceNode && e.to === targetNode) || 
                (e.from === targetNode && e.to === sourceNode)
            ).length;
            
            // Create new edge with improved styling to avoid overlapping
            const newEdge = {
                id: edgeId,
                from: sourceNode,
                to: targetNode,
                label: deliverableName,
                type: deliverableType,
                color: edgeColor,
                dashes: edgeDashes,
                width: 2,
                font: {
                    size: 12,
                    align: 'middle',
                    background: 'white',
                    strokeWidth: 2,
                    strokeColor: '#ffffff'
                },
                // Use different roundness values to avoid overlapping edges between same nodes
                smooth: {
                    enabled: true,
                    type: "continuous",
                    forceDirection: "none",
                    roundness: 0.3 + (edgesBetweenNodes * 0.15)
                }
            };
            
            // Add to data structures
            vnaData.edges.push(newEdge);
            edges.add(newEdge);
            
            // Guardar y actualizar
            saveData();
            
            // Limpiar formulario
            document.getElementById('deliverable-name').value = '';
            
            // Feedback al usuario
            showNotification(`Transacci√≥n a√±adida correctamente de "${getNodeLabelById(sourceNode)}" a "${getNodeLabelById(targetNode)}"`, 'success');
        }
        
        // Get node label by ID
        function getNodeLabelById(nodeId) {
            const node = vnaData.nodes.find(n => n.id === nodeId);
            return node ? node.label : nodeId;
        }
        
        // Actualizar selectores de nodos
        function updateNodeSelectors() {
            const sourceSelect = document.getElementById('source-node');
            const targetSelect = document.getElementById('target-node');
            
            // Save current selections
            const currentSource = sourceSelect.value;
            const currentTarget = targetSelect.value;
            
            // Limpiar opciones actuales excepto la primera
            sourceSelect.innerHTML = '<option value="default" class="lang" data-es="Selecciona un rol de origen" data-ca="Selecciona un rol d\'origen">Selecciona un rol de origen</option>';
            targetSelect.innerHTML = '<option value="default" class="lang" data-es="Selecciona un rol destino" data-ca="Selecciona un rol dest√≠">Selecciona un rol destino</option>';
            
            // A√±adir opciones para cada nodo
            vnaData.nodes.forEach(node => {
                const sourceOption = document.createElement('option');
                sourceOption.value = node.id;
                sourceOption.textContent = node.label;
                sourceSelect.appendChild(sourceOption);
                
                const targetOption = document.createElement('option');
                targetOption.value = node.id;
                targetOption.textContent = node.label;
                targetSelect.appendChild(targetOption);
            });
            
            // Restore selections if they still exist
            if (vnaData.nodes.some(n => n.id === currentSource)) {
                sourceSelect.value = currentSource;
            }
            if (vnaData.nodes.some(n => n.id === currentTarget)) {
                targetSelect.value = currentTarget;
            }
        }
        
        // Quick start para VNA
        function quickStartVNA() {
            // Clear existing data
            if (vnaData.nodes.length > 0) {
                if (!confirm(document.documentElement.lang === 'ca' ? 
                    'Aix√≤ esborrar√† el teu mapa actual. Vols continuar?' : 
                    'Esto borrar√° tu mapa actual. ¬øQuieres continuar?')) {
                    return;
                }
                resetDataWithoutConfirmation();
            }
            
            // Add example roles
            const exampleRoles = [
                {id: "node-ceo", label: "CEO", group: 1},
                {id: "node-team", label: "Equipo", group: 2},
                {id: "node-clients", label: "Clientes", group: 3},
                {id: "node-providers", label: "Proveedores", group: 4},
                {id: "node-investors", label: "Inversores", group: 5}
            ];
            
            // Add nodes
            exampleRoles.forEach(role => {
                vnaData.nodes.push(role);
                nodes.add(role);
                nextNodeId++;
            });
            
            // Add example edges with different types and deliverables
            const exampleEdges = [
                {
                    id: "edge-ceo-team-strategy",
                    from: "node-ceo",
                    to: "node-team",
                    label: "Estrategia",
                    type: "intangible"
                },
                {
                    id: "edge-ceo-team-resources",
                    from: "node-ceo",
                    to: "node-team",
                    label: "Recursos",
                    type: "tangible"
                },
                {
                    id: "edge-team-clients-product",
                    from: "node-team",
                    to: "node-clients",
                    label: "Producto",
                    type: "tangible"
                },
                {
                    id: "edge-team-clients-support",
                    from: "node-team",
                    to: "node-clients",
                    label: "Soporte",
                    type: "intangible"
                },
                {
                    id: "edge-clients-providers-feedback",
                    from: "node-clients",
                    to: "node-providers",
                    label: "Feedback",
                    type: "intangible"
                },
                {
                    id: "edge-providers-team-materials",
                    from: "node-providers",
                    to: "node-team",
                    label: "Materiales",
                    type: "tangible"
                },
                {
                    id: "edge-investors-ceo-capital",
                    from: "node-investors",
                    to: "node-ceo",
                    label: "Capital",
                    type: "tangible"
                },
                {
                    id: "edge-ceo-investors-reports",
                    from: "node-ceo",
                    to: "node-investors",
                    label: "Reportes",
                    type: "intangible"
                }
            ];
            
            // Add edges with proper styling
            exampleEdges.forEach((edge, index) => {
                edge.width = 2;
                edge.font = {
                    size: 12,
                    align: 'middle',
                    background: 'white',
                    strokeWidth: 2,
                    strokeColor: '#ffffff'
                };
                
                // Determine edge appearance based on type
                if (edge.type === 'tangible') {
                    edge.color = { color: '#1e3a8a', highlight: '#4f46e5' };
                    edge.dashes = false;
                } else {
                    edge.color = { color: '#0ea5e9', highlight: '#0284c7' };
                    edge.dashes = [5, 5];
                }
                
                // Adjust roundness to avoid overlapping
                edge.smooth = {
                    enabled: true,
                    type: "continuous",
                    forceDirection: "none",
                    roundness: 0.3 + (index * 0.05)
                };
                
                vnaData.edges.push(edge);
                edges.add(edge);
                nextEdgeId++;
            });
            
            // Guardar y actualizar
            saveData();
            updateNodeSelectors();
            
            // Feedback al usuario
            showNotification('Se han a√±adido 5 roles y 8 transacciones de ejemplo a tu mapa de valor.', 'success');
        }
        
        // Exportar JSON
        function exportJSON() {
            if (vnaData.nodes.length === 0) {
                showNotification('No hay datos para exportar. Crea un mapa de valor primero.', 'error');
                return;
            }
            
            const dataStr = JSON.stringify(vnaData, null, 2);
            const blob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            
            const exportFileDefaultName = `vna-${vnaData.projectName.replace(/\s+/g, '-').toLowerCase()}-${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', url);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.style.display = 'none';
            document.body.appendChild(linkElement);
            
            linkElement.click();
            
            // Limpiar el objeto URL despu√©s de la descarga
            setTimeout(() => {
                document.body.removeChild(linkElement);
                URL.revokeObjectURL(url);
            }, 100);
            
            showNotification('Datos exportados correctamente como JSON', 'success');
        }
        
        // Exportar Roles como CSV
        function exportRolesCSV() {
            if (vnaData.nodes.length === 0) {
                showNotification('No hay roles para exportar. A√±ade roles a tu mapa de valor primero.', 'error');
                return;
            }
            
            // Crear contenido CSV
            let csvContent = "Rol\n"; // Header
            
            vnaData.nodes.forEach(node => {
                // Escapar comillas y comas en el nombre del rol
                let role = node.label || node.id;
                role = role.replace(/"/g, '""'); // Escapar comillas dobles
                csvContent += `"${role}"\n`;
            });
            
            // Crear blob y descargar
            const blob = new Blob([csvContent], {type: 'text/csv;charset=utf-8;'});
            const url = URL.createObjectURL(blob);
            
            const exportFileDefaultName = `vna-roles-${vnaData.projectName.replace(/\s+/g, '-').toLowerCase()}-${new Date().toISOString().slice(0,10)}.csv`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', url);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.style.display = 'none';
            document.body.appendChild(linkElement);
            
            linkElement.click();
            
            // Limpiar el objeto URL despu√©s de la descarga
            setTimeout(() => {
                document.body.removeChild(linkElement);
                URL.revokeObjectURL(url);
            }, 100);
            
            showNotification(`Se han exportado ${vnaData.nodes.length} roles como CSV. Este archivo es compatible con la importaci√≥n en la App de Contabilidad de Valor.`, 'success');
        }
        
        // Exportar como PNG
        function exportPNG() {
            if (vnaData.nodes.length === 0) {
                showNotification('No hay datos para exportar. Crea un mapa de valor primero.', 'error');
                return;
            }
            
            // Get the PNG data URL
            const pngData = network.getImage();
            
            // Create a link and trigger download
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', pngData);
            linkElement.setAttribute('download', `vna-${vnaData.projectName.replace(/\s+/g, '-').toLowerCase()}-${new Date().toISOString().slice(0,10)}.png`);
            linkElement.style.display = 'none';
            document.body.appendChild(linkElement);
            
            linkElement.click();
            
            // Clean up
            setTimeout(() => {
                document.body.removeChild(linkElement);
            }, 100);
            
            showNotification('Mapa de valor exportado correctamente como PNG', 'success');
        }
        
        // Limpiar datos
        function resetData() {
            if (confirm(document.documentElement.lang === 'ca' ? 
                'Est√†s segur que vols esborrar totes les dades del mapa de valor?' : 
                '¬øEst√°s seguro de que quieres borrar todos los datos del mapa de valor?')) {
                resetDataWithoutConfirmation();
                showNotification('Datos borrados correctamente', 'success');
            }
        }
        
        // Reset data without confirmation (for quick start)
        function resetDataWithoutConfirmation() {
            // Clear data structures
            vnaData = {
                projectName: "Proyecto MASIA",
                nodes: [],
                edges: []
            };
            
            // Clear vis-network data
            nodes.clear();
            edges.clear();
            
            // Reset counters
            nextNodeId = 1;
            nextEdgeId = 1;
            
            // Limpiar campos de formulario
            document.getElementById('project-name').value = "Proyecto MASIA";
            document.getElementById('node-name').value = '';
            document.getElementById('deliverable-name').value = '';
            
            // Update selectors
            updateNodeSelectors();
            
            // Save
            saveData();
        }
        
        // Show notification
        function showNotification(message, type) {
            // Remove existing notifications
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = message.replace(/\n/g, '<br>');
            
            // Add to body
            document.body.appendChild(notification);
            
            // Remove after animation
            setTimeout(() => {
                if (notification.parentNode) {
                    document.body.removeChild(notification);
                }
            }, 3000);
        }
        
        // Guardar datos en localStorage
        function saveData() {
            localStorage.setItem('vnaData', JSON.stringify(vnaData));
        }
        
        // Cargar datos de localStorage
        function loadSavedData() {
            const saved = localStorage.getItem('vnaData');
            if (saved) {
                const parsedData = JSON.parse(saved);
                
                vnaData = {
                    projectName: parsedData.projectName || "Proyecto MASIA",
                    nodes: parsedData.nodes || [],
                    edges: parsedData.edges || []
                };
                
                // Restore counters
                if (vnaData.nodes.length > 0) {
                    const maxNodeId = Math.max(...vnaData.nodes.map(n => parseInt(n.id.split('-')[1] || 0)));
                    nextNodeId = maxNodeId + 1;
                }
                
                if (vnaData.edges.length > 0) {
                    const maxEdgeId = Math.max(...vnaData.edges.map(e => parseInt(e.id.split('-')[1] || 0)));
                    nextEdgeId = maxEdgeId + 1;
                }
                
                // Restaurar nombre del proyecto en el input
                document.getElementById('project-name').value = vnaData.projectName;
                
                // Add nodes to vis-network
                vnaData.nodes.forEach(node => {
                    nodes.add(node);
                });
                
                // Add edges to vis-network
                vnaData.edges.forEach(edge => {
                    // Ensure edge has all required properties
                    if (!edge.font) {
                        edge.font = {
                            size: 12,
                            align: 'middle',
                            background: 'white',
                            strokeWidth: 2,
                            strokeColor: '#ffffff'
                        };
                    }
                    if (!edge.smooth) {
                        edge.smooth = {
                            enabled: true,
                            type: "continuous",
                            forceDirection: "none",
                            roundness: 0.5
                        };
                    }
                    edges.add(edge);
                });
                
                // Update selectors
                updateNodeSelectors();
            }
        }
        
        // Run tests manually
        function runTests() {
            const results = testSuite.runTests();
            testSuite.displayResults(results);
        }
    </script>
</body>
</html>
