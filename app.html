<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Value Network Analysis App | TeamTowers Hum√†. Herramienta para mapear flujos de valor tangibles e intangibles en tu organizaci√≥n.">
    <meta name="keywords" content="Value Network Analysis, VNA, mapeo valor, TeamTowers Hum√†, consultor√≠a RRHH, Vilafranca del Pened√®s">
    <meta name="author" content="TeamTowers Hum√†">
    <meta name="robots" content="index, follow">
    <title>Value Network Analysis App | TeamTowers Hum√†</title>
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="Value Network Analysis App | TeamTowers Hum√†">
    <meta property="og:description" content="Herramienta interactiva para mapear flujos de valor tangibles e intangibles en tu organizaci√≥n. Visualiza conexiones y optimiza procesos.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://teamtowershuma.netlify.app/app">
    <meta property="og:image" content="https://raw.githubusercontent.com/asolache/Teamtowers/main/images/logoteamtowers.png">
    <meta property="og:locale" content="es_ES">
    <meta property="og:locale:alternate" content="ca_ES">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Value Network Analysis App | TeamTowers Hum√†">
    <meta name="twitter:description" content="Mapea flujos de valor tangibles e intangibles con nuestra herramienta interactiva">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/asolache/Teamtowers/main/images/logoteamtowers.png">
    
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    
    <style>
        :root {
            --primary: #1e3a8a; /* Azul TeamTowers */
            --secondary: #4f46e5; /* Azul m√°s claro */
            --accent: #8b5cf6; /* Morado TeamTowers */
            --dark: #0f172a;
            --light: #f8fafc;
            --gold: #f59e0b;
            --success: #10b981;
            --warning: #fbbf24;
            --gray: #64748b;
            --border-radius: 12px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #fff;
            overflow-x: hidden;
        }
        
        /* Language Selector */
        .language-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 50px;
            padding: 5px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 5px;
        }
        
        .lang-btn {
            padding: 8px 16px;
            border: none;
            background: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .lang-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(30, 58, 138, 0.3);
        }
        
        /* Header */
        header {
            background: linear-gradient(135deg, var(--dark) 0%, #1e293b 100%);
            color: white;
            padding: 20px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
            z-index: 10;
        }
        
        .header-logo {
            height: 60px;
            margin-bottom: 15px;
            filter: drop-shadow(0 4px 10px rgba(0,0,0,0.3));
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .tagline {
            font-size: 1.4rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        /* Main Content */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        @media (max-width: 992px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            height: fit-content;
        }
        
        .panel h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel h2::before {
            content: '';
            display: inline-block;
            width: 8px;
            height: 24px;
            background: var(--accent);
            border-radius: 4px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .input-group label::before {
            content: '‚Ä¢';
            color: var(--accent);
            font-size: 24px;
            line-height: 1;
        }
        
        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.2);
        }
        
        .input-group textarea {
            min-height: 100px;
            resize: vertical;
            font-family: monospace;
            font-size: 0.95rem;
        }
        
        .bulk-input {
            background: var(--light);
            border-left: 4px solid var(--accent);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .bulk-input p {
            margin-bottom: 10px;
            font-size: 0.95rem;
            color: var(--gray);
        }
        
        .bulk-input code {
            background: rgba(30, 58, 138, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-weight: 600;
            display: block;
            margin: 5px 0;
            font-size: 0.9rem;
        }
        
        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.05rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }
        
        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #0da27f 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #b91c1c 100%);
            color: white;
        }
        
        .btn-export {
            background: linear-gradient(135deg, #7e3af2 0%, #4f46e5 100%);
            color: white;
            grid-column: span 2;
        }
        
        .visualization-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            position: relative;
        }
        
        #vna-container {
            width: 100%;
            height: 700px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            background: var(--light);
            margin-top: 15px;
        }
        
        #vna-svg {
            width: 100%;
            height: 100%;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            padding: 15px;
            background: var(--light);
            border-radius: 8px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }
        
        .legend-line {
            width: 30px;
            height: 3px;
            display: inline-block;
            border-radius: 2px;
        }
        
        .legend-tangible {
            background: var(--primary);
        }
        
        .legend-intangible {
            background: var(--accent);
            border-style: dashed;
            border-width: 0 0 2px 0;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 10px 20px;
            background: white;
            border: 2px solid var(--primary);
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .control-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: linear-gradient(135deg, var(--light) 0%, #e0e7ff 100%);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 15px;
            border: 1px solid rgba(30, 58, 138, 0.1);
        }
        
        .stat-item {
            text-align: center;
            min-width: 100px;
            padding: 8px 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--gray);
            margin-top: 3px;
        }
        
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 20px;
            color: var(--gray);
        }
        
        .empty-state svg {
            width: 120px;
            height: 120px;
            margin-bottom: 20px;
            color: var(--accent);
            opacity: 0.7;
        }
        
        .empty-state h3 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .empty-state p {
            max-width: 500px;
            margin-bottom: 25px;
            line-height: 1.7;
        }
        
        .instructions {
            background: linear-gradient(135deg, var(--light) 0%, #e0e7ff 100%);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-top: 25px;
            border-left: 4px solid var(--accent);
        }
        
        .instructions h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instructions h3::before {
            content: '‚ÑπÔ∏è';
            font-size: 1.4rem;
        }
        
        .instructions ol {
            padding-left: 25px;
            margin-top: 10px;
        }
        
        .instructions li {
            margin-bottom: 10px;
            line-height: 1.7;
        }
        
        .instructions code {
            background: rgba(30, 58, 138, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-weight: 600;
        }
        
        .example-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }
        
        .example-section h4 {
            margin-bottom: 12px;
            color: var(--primary);
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .example-section h4::before {
            content: 'üìå';
        }
        
        .example-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            font-family: monospace;
            font-size: 0.95rem;
            color: var(--primary);
            position: relative;
            padding-left: 30px;
        }
        
        .example-item::before {
            content: '‚Üí';
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent);
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .node {
            cursor: pointer;
            stroke: #fff;
            stroke-width: 3px;
        }
        
        .node text {
            pointer-events: none;
            text-anchor: middle;
            dominant-baseline: middle;
            font-weight: 600;
            fill: var(--dark);
            font-size: 14px;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }
        
        .link {
            stroke: var(--gray);
            stroke-width: 2px;
            fill: none;
            marker-end: url(#arrowhead);
        }
        
        .link-tangible {
            stroke: var(--primary);
            stroke-width: 3px;
        }
        
        .link-intangible {
            stroke: var(--accent);
            stroke-width: 2px;
            stroke-dasharray: 5, 5;
        }
        
        .link-path {
            fill: none;
            stroke-width: 3px;
            marker-end: url(#arrowhead);
        }
        
        .link-label {
            font-size: 11px;
            fill: var(--dark);
            pointer-events: none;
            text-anchor: middle;
        }
        
        .link-label tspan {
            dominant-baseline: middle;
        }
        
        .link-label.type {
            font-weight: 600;
            fill: var(--primary);
        }
        
        .link-label.deliverable {
            font-size: 10px;
            fill: var(--gray);
        }
        
        .simulation-running {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            color: var(--warning);
            display: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            border: 2px solid var(--warning);
        }
        
        .tooltip {
            position: absolute;
            background: rgba(15, 23, 42, 0.95);
            color: white;
            padding: 15px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.6;
            pointer-events: none;
            max-width: 350px;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: none;
            border: 1px solid var(--accent);
        }
        
        .tooltip h4 {
            margin-bottom: 8px;
            color: var(--accent);
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tooltip h4::before {
            content: 'üí°';
        }
        
        .tooltip p {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
        }
        
        .tooltip .label {
            font-weight: 600;
            color: var(--primary);
            margin-right: 5px;
        }
        
        .tooltip .value {
            color: white;
        }
        
        .tooltip .type-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 12px;
            margin-top: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .tooltip .type-badge.tangible {
            background: rgba(16, 185, 129, 0.25);
            color: #0d9488;
            border: 1px solid #14b8a6;
        }
        
        .tooltip .type-badge.intangible {
            background: rgba(139, 92, 246, 0.25);
            color: #7e3af2;
            border: 1px solid #8b5cf6;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 5px;
        }
        
        .badge-tangible {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .badge-intangible {
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
        }
        
        /* Footer */
        footer {
            background: var(--dark);
            color: rgba(255, 255, 255, 0.85);
            padding: 60px 20px 30px;
            margin-top: 60px;
        }
        
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .footer-col h3 {
            color: white;
            font-size: 1.6rem;
            margin-bottom: 25px;
            position: relative;
            padding-bottom: 10px;
        }
        
        .footer-col h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 3px;
            background: var(--accent);
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 12px;
        }
        
        .footer-links a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: var(--transition);
            display: block;
            padding: 5px 0;
            font-size: 1.05rem;
        }
        
        .footer-links a:hover {
            color: var(--accent);
            transform: translateX(5px);
        }
        
        .copyright {
            text-align: center;
            padding-top: 40px;
            margin-top: 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .tagline {
                font-size: 1.1rem;
            }
            
            .panel {
                padding: 20px;
            }
            
            #vna-container {
                height: 500px;
            }
        }
        
        @media (max-width: 480px) {
            .language-selector {
                top: 15px;
                right: 15px;
                padding: 3px;
            }
            
            .header-logo {
                height: 50px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .tagline {
                font-size: 1rem;
            }
            
            .container {
                padding: 20px 15px;
            }
            
            .btn {
                padding: 12px 15px;
                font-size: 0.95rem;
            }
            
            #vna-container {
                height: 400px;
            }
            
            .legend {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .control-btn {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- Language Selector -->
    <div class="language-selector">
        <button class="lang-btn active" data-lang="es">ES</button>
        <button class="lang-btn" data-lang="ca">CA</button>
    </div>
    
    <!-- Header -->
    <header>
        <div class="header-content">
            <img src="https://raw.githubusercontent.com/asolache/Teamtowers/main/images/logoteamtowers.png" alt="TeamTowers Hum√†" class="header-logo">
            <h1 class="lang" data-es="Value Network Analysis App" data-ca="Aplicaci√≥ Value Network Analysis">Value Network Analysis App</h1>
            <p class="tagline lang" data-es="Mapea flujos de valor tangibles e intangibles en tu organizaci√≥n" data-ca="Mapeja fluxos de valor tangibles i intangibles a la teva organitzaci√≥">Mapea flujos de valor tangibles e intangibles en tu organizaci√≥n</p>
        </div>
    </header>
    
    <!-- Main Content -->
    <div class="container">
        <div class="app-container">
            <div class="panel">
                <h2 class="lang" data-es="‚ûï A√±adir Transacci√≥n" data-ca="‚ûï Afegir Transacci√≥">‚ûï A√±adir Transacci√≥n</h2>
                <div class="input-group">
                    <label class="lang" data-es="Origen" data-ca="Origen">Origen</label>
                    <input type="text" id="origin" placeholder="Ej: Cliente, Vendedor, IT">
                </div>
                <div class="input-group">
                    <label class="lang" data-es="Destino" data-ca="Dest√≠">Destino</label>
                    <input type="text" id="destination" placeholder="Ej: Vendedor, Cliente, Marketing">
                </div>
                <div class="input-group">
                    <label class="lang" data-es="Tipo de Valor" data-ca="Tipus de Valor">Tipo de Valor</label>
                    <select id="type">
                        <option value="tangible" class="lang" data-es="Tangible (bienes, servicios, datos)" data-ca="Tangible (b√©ns, serveis, dades)">Tangible (bienes, servicios, datos)</option>
                        <option value="intangible" class="lang" data-es="Intangible (confianza, conocimiento, feedback)" data-ca="Intangible (confian√ßa, coneixement, feedback)">Intangible (confianza, conocimiento, feedback)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="lang" data-es="Entregable" data-ca="Entregable"><span class="lang" data-es="Entregable" data-ca="Entregable">Entregable</span> <span class="badge badge-tangible lang" data-es="Texto libre" data-ca="Text lliure">Texto libre</span></label>
                    <textarea id="deliverable" placeholder="Ej: Pedido, Confianza, Informe de uso web, Feedback de campa√±a"></textarea>
                </div>
                <div class="btn-group">
                    <button id="add-transaction" class="btn btn-primary">
                        <span>‚ú®</span> <span class="lang" data-es="A√±adir Transacci√≥n" data-ca="Afegir Transacci√≥">A√±adir Transacci√≥n</span>
                    </button>
                    <button id="clear-all" class="btn btn-danger">
                        <span>üóëÔ∏è</span> <span class="lang" data-es="Limpiar Todo" data-ca="Netejar Tot">Limpiar Todo</span>
                    </button>
                    <button id="load-example" class="btn btn-secondary">
                        <span>üìö</span> <span class="lang" data-es="Cargar Ejemplo" data-ca="Carregar Exemple">Cargar Ejemplo</span>
                    </button>
                    <button id="reset-layout" class="btn btn-warning">
                        <span>üîÑ</span> <span class="lang" data-es="Resetear Posiciones" data-ca="Reiniciar Posicions">Resetear Posiciones</span>
                    </button>
                </div>
                
                <div class="bulk-input">
                    <h3 class="lang" data-es="üì• A√±adir Varias Transacciones" data-ca="üì• Afegir Diverses Transaccions">üì• A√±adir Varias Transacciones</h3>
                    <p class="lang" data-es="Pega varias transacciones en formato:" data-ca="Enganxa diverses transaccions en format:">Pega varias transacciones en formato:</p>
                    <code>Origen ‚Üí Destino | tipo | Entregable</code>
                    <textarea id="bulk-input" placeholder="Cliente ‚Üí Vendedor | tangible | Pedido&#10;Vendedor ‚Üí Cliente | intangible | Confianza&#10;IT ‚Üí Marketing | tangible | Informe de uso web"></textarea>
                    <button id="add-bulk" class="btn btn-success" style="margin-top: 10px; width: 100%;">
                        <span>üöÄ</span> <span class="lang" data-es="A√±adir Todas las Transacciones" data-ca="Afegir Totes les Transaccions">A√±adir Todas las Transacciones</span>
                    </button>
                </div>
                
                <div class="panel" style="margin-top: 25px;">
                    <h2>üíæ <span class="lang" data-es="Exportar Mapa" data-ca="Exportar Mapa">Exportar Mapa</span></h2>
                    <div class="btn-group">
                        <button id="export-png" class="btn btn-export">
                            <span>üñºÔ∏è</span> <span class="lang" data-es="Descargar PNG" data-ca="Descarregar PNG">Descargar PNG</span>
                        </button>
                        <button id="export-svg" class="btn btn-export">
                            <span>üé®</span> <span class="lang" data-es="Descargar SVG" data-ca="Descarregar SVG">Descargar SVG</span>
                        </button>
                        <button id="export-json" class="btn btn-export">
                            <span>üìä</span> <span class="lang" data-es="Descargar JSON" data-ca="Descarregar JSON">Descargar JSON</span>
                        </button>
                        <button id="copy-data" class="btn btn-export">
                            <span>üìã</span> <span class="lang" data-es="Copiar Datos" data-ca="Copiar Dades">Copiar Datos</span>
                        </button>
                    </div>
                </div>
                
                <div class="instructions">
                    <h3 class="lang" data-es="Instrucciones de Uso" data-ca="Instruccions d'√ös">Instrucciones de Uso</h3>
                    <ol>
                        <li class="lang" data-es="Escribe los roles y transacciones en el formato: <code>Origen ‚Üí Destino | tipo | Entregable</code>" data-ca="Escriu els rols i transaccions en el format: <code>Origen ‚Üí Dest√≠ | tipus | Entregable</code>">Escribe los roles y transacciones en el formato: <code>Origen ‚Üí Destino | tipo | Entregable</code></li>
                        <li class="lang" data-es="Haz clic en los nodos para arrastrarlos y organizar el mapa" data-ca="Fes clic als nodes per arrossegar-los i organitzar el mapa">Haz clic en los nodos para arrastrarlos y organizar el mapa</li>
                        <li class="lang" data-es="Usa los controles de zoom para navegar por mapas grandes" data-ca="Utilitza els controls de zoom per navegar per mapes grans">Usa los controles de zoom para navegar por mapas grandes</li>
                        <li class="lang" data-es="Pasa el rat√≥n sobre las conexiones para ver detalles completos" data-ca="Passa el ratol√≠ sobre les connexions per veure detalls complets">Pasa el rat√≥n sobre las conexiones para ver detalles completos</li>
                        <li class="lang" data-es="Exporta tu mapa en PNG, SVG o JSON para compartir o editar" data-ca="Exporta el teu mapa en PNG, SVG o JSON per compartir o editar">Exporta tu mapa en PNG, SVG o JSON para compartir o editar</li>
                    </ol>
                    
                    <div class="example-section">
                        <h4 class="lang" data-es="Ejemplos de Transacciones:" data-ca="Exemples de Transaccions:">Ejemplos de Transacciones:</h4>
                        <div class="example-item">Cliente ‚Üí Vendedor | tangible | Pedido</div>
                        <div class="example-item">Vendedor ‚Üí Cliente | intangible | Confianza</div>
                        <div class="example-item">IT ‚Üí Marketing | tangible | Informe de uso web</div>
                        <div class="example-item">Marketing ‚Üí IT | intangible | Feedback de campa√±a</div>
                    </div>
                </div>
            </div>
            
            <div class="visualization-container">
                <h2>üó∫Ô∏è <span class="lang" data-es="Mapa de Red de Valor" data-ca="Mapa de Xarxa de Valor">Mapa de Red de Valor</span></h2>
                <div id="vna-container">
                    <svg id="vna-svg"></svg>
                    <div class="empty-state" id="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <h3 class="lang" data-es="A√±ade tu primera transacci√≥n" data-ca="Afegeix la teva primera transacci√≥">A√±ade tu primera transacci√≥n</h3>
                        <p class="lang" data-es="Define roles y flujos de valor para visualizar las conexiones en tu organizaci√≥n. Comienza con transacciones simples y ve construyendo tu red de valor completa." data-ca="Defineix rols i fluxos de valor per visualitzar les connexions a la teva organitzaci√≥. Comen√ßa amb transaccions simples i ves construint la teva xarxa de valor completa.">Define roles y flujos de valor para visualizar las conexiones en tu organizaci√≥n. Comienza con transacciones simples y ve construyendo tu red de valor completa.</p>
                        <button id="add-first-transaction" class="btn btn-primary" style="margin-top: 15px;">
                            <span>‚ú®</span> <span class="lang" data-es="A√±adir Transacci√≥n de Ejemplo" data-ca="Afegir Transacci√≥ d'Exemple">A√±adir Transacci√≥n de Ejemplo</span>
                        </button>
                    </div>
                    <div class="simulation-running" id="simulation-status">Optimizando distribuci√≥n de nodos...</div>
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-line legend-tangible"></div>
                        <span class="lang" data-es="Tangible (bienes, servicios, datos)" data-ca="Tangible (b√©ns, serveis, dades)">Tangible (bienes, servicios, datos)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line legend-intangible"></div>
                        <span class="lang" data-es="Intangible (confianza, conocimiento, feedback)" data-ca="Intangible (confian√ßa, coneixement, feedback)">Intangible (confianza, conocimiento, feedback)</span>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="control-btn" id="zoom-in">
                        <span>üîç+</span> <span class="lang" data-es="Zoom +" data-ca="Zoom +">Zoom +</span>
                    </button>
                    <button class="control-btn" id="zoom-out">
                        <span>üîç-</span> <span class="lang" data-es="Zoom -" data-ca="Zoom -">Zoom -</span>
                    </button>
                    <button class="control-btn" id="zoom-reset">
                        <span>‚Ü∫</span> <span class="lang" data-es="Reset Zoom" data-ca="Reiniciar Zoom">Reset Zoom</span>
                    </button>
                    <button class="control-btn" id="fit-to-screen">
                        <span>‚ùê</span> <span class="lang" data-es="Ajustar a Pantalla" data-ca="Ajustar a Pantalla">Ajustar a Pantalla</span>
                    </button>
                </div>
                
                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-value" id="node-count">0</div>
                        <div class="stat-label lang" data-es="Roles" data-ca="Rols">Roles</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="link-count">0</div>
                        <div class="stat-label lang" data-es="Transacciones" data-ca="Transaccions">Transacciones</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="tangible-count">0</div>
                        <div class="stat-label lang" data-es="Tangibles" data-ca="Tangibles">Tangibles</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="intangible-count">0</div>
                        <div class="stat-label lang" data-es="Intangibles" data-ca="Intangibles">Intangibles</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer>
        <div class="footer-grid">
            <div class="footer-col">
                <h3 class="lang" data-es="TeamTowers Hum√†" data-ca="TeamTowers Hum√†">TeamTowers Hum√†</h3>
                <p class="lang" data-es="De las torres humanas a las organizaciones humanas. Consultor√≠a estrat√©gica de RRHH con enfoque humanista desde Vilafranca del Pened√®s." data-ca="De les torres humanes a les organitzacions humanes. Consultoria estrat√®gica de RRHH amb enfocament humanista des de Vilafranca del Pened√®s.">De las torres humanas a las organizaciones humanas. Consultor√≠a estrat√©gica de RRHH con enfoque humanista desde Vilafranca del Pened√®s.</p>
            </div>
            <div class="footer-col">
                <h3 class="lang" data-es="Servicios" data-ca="Serveis">Servicios</h3>
                <ul class="footer-links">
                    <li><a href="/" class="lang" data-es="TeamTowers" data-ca="TeamTowers">TeamTowers</a></li>
                    <li><a href="/valor" class="lang" data-es="Value Network Analysis" data-ca="Value Network Analysis">Value Network Analysis</a></li>
                    <li><a href="/coops" class="lang" data-es="Comunidades de Pr√°ctica" data-ca="Comunitats de Pr√†ctica">Comunidades de Pr√°ctica</a></li>
                    <li><a href="/rrhh" class="lang" data-es="Business Partner RRHH" data-ca="Business Partner RRHH">Business Partner RRHH</a></li>
                    <li><a href="/events" class="lang" data-es="Producci√≥n de Eventos" data-ca="Producci√≥ d'Esdeveniments">Producci√≥n de Eventos</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3 class="lang" data-es="Recursos" data-ca="Recursos">Recursos</h3>
                <ul class="footer-links">
                    <li><a href="https://cursovna.netlify.app/" target="_blank" class="lang" data-es="Curso de VNA" data-ca="Curs de VNA">Curso de VNA</a></li>
                    <li><a href="https://valuenetworklab.netlify.app/" target="_blank" class="lang" data-es="Value Network Lab" data-ca="Value Network Lab">Value Network Lab</a></li>
                    <li><a href="https://www.teamtowers.eu" target="_blank" class="lang" data-es="TeamTowers Original" data-ca="TeamTowers Original">TeamTowers Original</a></li>
                    <li><a href="https://alvarosolache.netlify.app/cv2" target="_blank" class="lang" data-es="Sobre √Ålvaro Solache" data-ca="Sobre √Älvaro Solache">Sobre √Ålvaro Solache</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3 class="lang" data-es="Contacto" data-ca="Contacte">Contacto</h3>
                <ul class="footer-links">
                    <li>Vilafranca del Pened√®s, Barcelona</li>
                    <li>+34 629 86 77 15</li>
                    <li>
                        <a href="mailto:asolache@mac.com" style="color: var(--accent); font-weight: 600;">
                            <span class="lang" data-es="Enviar mensaje" data-ca="Enviar missatge">Enviar mensaje</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://linkedin.com/in/alvarosolache" target="_blank" style="color: var(--accent); font-weight: 600;">LinkedIn</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="copyright">
            <p class="lang" data-es="¬© 2026 TeamTowers Hum√†. Todos los derechos reservados." data-ca="¬© 2026 TeamTowers Hum√†. Tots els drets reservats.">¬© 2026 TeamTowers Hum√†. Todos los derechos reservados.</p>
        </div>
    </footer>
    
    <div class="tooltip" id="tooltip"></div>
    
    <script>
        // Language switching functionality
        document.addEventListener('DOMContentLoaded', function() {
            const langButtons = document.querySelectorAll('.lang-btn');
            const translatableElements = document.querySelectorAll('[data-es], [data-ca]');
            
            // Set initial language based on browser settings or default to Spanish
            const userLang = navigator.language.startsWith('ca') ? 'ca' : 'es';
            setActiveLanguage(userLang);
            
            // Add click event to language buttons
            langButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const selectedLang = this.getAttribute('data-lang');
                    setActiveLanguage(selectedLang);
                    
                    // Update active button
                    langButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Set active language
            function setActiveLanguage(lang) {
                // Update all translatable elements
                translatableElements.forEach(element => {
                    if (element.hasAttribute(`data-${lang}`)) {
                        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                            element.placeholder = element.getAttribute(`data-${lang}`);
                        } else {
                            // Use innerHTML to allow HTML content in translations
                            element.innerHTML = element.getAttribute(`data-${lang}`);
                        }
                    }
                });
                
                // Update HTML lang attribute
                document.documentElement.setAttribute('lang', lang);
            }
            
            // Initialize VNA app after language is set
            initVNAApp();
        });
        
        // VNA App functionality
        function initVNAApp() {
            // Estado de la aplicaci√≥n
            let nodes = [];
            let links = [];
            let simulation;
            let svg;
            let g;
            let width = 1100;
            let height = 700;
            let zoom;
            let isSimulationRunning = false;
            
            // Inicializaci√≥n
            const container = document.getElementById('vna-container');
            width = container.clientWidth;
            height = container.clientHeight - 60; // Adjust for controls
            
            svg = d3.select('#vna-svg')
                .attr('width', width)
                .attr('height', height)
                .append('g');
            
            // Configurar zoom
            zoom = d3.zoom()
                .scaleExtent([0.1, 4])
                .on('zoom', (event) => {
                    g.attr('transform', event.transform);
                });
            
            d3.select('#vna-svg')
                .call(zoom)
                .on('dblclick.zoom', null); // Deshabilitar doble click para zoom
            
            // A√±adir marcador de flecha
            svg.append('defs').append('marker')
                .attr('id', 'arrowhead')
                .attr('viewBox', '-0 -5 10 10')
                .attr('refX', 15)
                .attr('refY', 0)
                .attr('orient', 'auto')
                .attr('markerWidth', 8)
                .attr('markerHeight', 8)
                .attr('xoverflow', 'visible')
                .append('svg:path')
                .attr('d', 'M 0,-5 L 10 ,0 L 0,5')
                .attr('fill', '#4b5563')
                .style('stroke', 'none');
            
            // Eventos de botones
            document.getElementById('add-transaction').addEventListener('click', addTransaction);
            document.getElementById('add-bulk').addEventListener('click', addBulkTransactions);
            document.getElementById('clear-all').addEventListener('click', clearAll);
            document.getElementById('load-example').addEventListener('click', loadExample);
            document.getElementById('reset-layout').addEventListener('click', resetLayout);
            document.getElementById('export-png').addEventListener('click', exportPNG);
            document.getElementById('export-svg').addEventListener('click', exportSVG);
            document.getElementById('export-json').addEventListener('click', exportJSON);
            document.getElementById('copy-data').addEventListener('click', copyData);
            document.getElementById('add-first-transaction').addEventListener('click', addFirstTransaction);
            document.getElementById('zoom-in').addEventListener('click', () => zoom.scaleBy(svg.transition().duration(300), 1.3));
            document.getElementById('zoom-out').addEventListener('click', () => zoom.scaleBy(svg.transition().duration(300), 0.7));
            document.getElementById('zoom-reset').addEventListener('click', resetZoom);
            document.getElementById('fit-to-screen').addEventListener('click', fitToScreen);
            
            // Cargar datos guardados
            loadSavedData();
            
            // Si no hay datos, mostrar estado vac√≠o
            updateEmptyState();
            
            // Funciones de la aplicaci√≥n
            function addTransaction() {
                const origin = document.getElementById('origin').value.trim();
                const destination = document.getElementById('destination').value.trim();
                const type = document.getElementById('type').value;
                const deliverable = document.getElementById('deliverable').value.trim();
                
                if (!origin || !destination || !deliverable) {
                    alert(document.documentElement.lang === 'ca' ? 
                        'Si us plau, completa tots els camps' : 
                        'Por favor, completa todos los campos');
                    return;
                }
                
                addTransactionToData(origin, destination, type, deliverable);
                
                // Limpiar formulario
                document.getElementById('origin').value = '';
                document.getElementById('destination').value = '';
                document.getElementById('deliverable').value = '';
                
                // Guardar datos
                saveData();
                
                // Actualizar visualizaci√≥n
                updateVisualization();
                
                // Ocultar estado vac√≠o
                document.getElementById('empty-state').style.display = 'none';
            }
            
            function addBulkTransactions() {
                const bulkInput = document.getElementById('bulk-input').value.trim();
                if (!bulkInput) {
                    alert(document.documentElement.lang === 'ca' ? 
                        'Enganxa les transaccions que vols afegir' : 
                        'Pega las transacciones que quieres a√±adir');
                    return;
                }
                
                const lines = bulkInput.split('\n');
                let addedCount = 0;
                
                lines.forEach(line => {
                    line = line.trim();
                    if (!line) return;
                    
                    // Parsear el formato: Origen ‚Üí Destino | tipo | Entregable
                    const parts = line.split('|');
                    if (parts.length !== 3) {
                        console.warn('Formato incorrecto:', line);
                        return;
                    }
                    
                    const originDest = parts[0].trim().split('‚Üí');
                    if (originDest.length !== 2) {
                        console.warn('Formato de origen/destino incorrecto:', line);
                        return;
                    }
                    
                    const origin = originDest[0].trim();
                    const destination = originDest[1].trim();
                    const type = parts[1].trim().toLowerCase();
                    const deliverable = parts[2].trim();
                    
                    if (origin && destination && deliverable && (type === 'tangible' || type === 'intangible')) {
                        addTransactionToData(origin, destination, type, deliverable);
                        addedCount++;
                    }
                });
                
                if (addedCount > 0) {
                    // Limpiar textarea
                    document.getElementById('bulk-input').value = '';
                    
                    // Guardar datos
                    saveData();
                    
                    // Actualizar visualizaci√≥n
                    updateVisualization();
                    
                    // Ocultar estado vac√≠o
                    document.getElementById('empty-state').style.display = 'none';
                    
                    alert(`${addedCount} ${document.documentElement.lang === 'ca' ? 
                        'transaccions afegides correctament' : 
                        'transacciones a√±adidas correctamente'}`);
                } else {
                    alert(document.documentElement.lang === 'ca' ? 
                        'No s\'han pogut afegir transaccions. Revisa el format.' : 
                        'No se han podido a√±adir transacciones. Revisa el formato.');
                }
            }
            
            function addTransactionToData(origin, destination, type, deliverable) {
                // A√±adir nodos si no existen
                if (!nodes.find(n => n.id === origin)) {
                    nodes.push({id: origin, group: 1});
                }
                
                if (!nodes.find(n => n.id === destination)) {
                    nodes.push({id: destination, group: 1});
                }
                
                // A√±adir enlace
                links.push({
                    source: origin,
                    target: destination,
                    type: type,
                    deliverable: deliverable,
                    value: 1
                });
            }
            
            function addFirstTransaction() {
                document.getElementById('origin').value = 'Cliente';
                document.getElementById('destination').value = 'Vendedor';
                document.getElementById('type').value = 'tangible';
                document.getElementById('deliverable').value = 'Pedido';
                addTransaction();
            }
            
            function loadExample() {
                if (links.length > 0 && !confirm(document.documentElement.lang === 'ca' ? 
                    'Vols reempla√ßar les dades actuals amb l\'exemple?' : 
                    '¬øQuieres reemplazar los datos actuales con el ejemplo?')) {
                    return;
                }
                
                nodes = [
                    {id: "Cliente", group: 1},
                    {id: "Vendedor", group: 2},
                    {id: "IT", group: 3},
                    {id: "Marketing", group: 4},
                    {id: "CEO", group: 5}
                ];
                
                links = [
                    {source: "Cliente", target: "Vendedor", type: "tangible", deliverable: "Pedido", value: 1},
                    {source: "Vendedor", target: "Cliente", type: "intangible", deliverable: "Confianza y satisfacci√≥n", value: 1},
                    {source: "IT", target: "Marketing", type: "tangible", deliverable: "Informe de uso web y analytics", value: 1},
                    {source: "Marketing", target: "IT", type: "intangible", deliverable: "Feedback de campa√±a y necesidades de usuarios", value: 1},
                    {source: "Vendedor", target: "CEO", type: "tangible", deliverable: "Reporte de ventas y proyecciones", value: 1},
                    {source: "CEO", target: "Vendedor", type: "intangible", deliverable: "Visi√≥n estrat√©gica y direcci√≥n", value: 1},
                    {source: "Marketing", target: "Cliente", type: "tangible", deliverable: "Contenido y campa√±as publicitarias", value: 1},
                    {source: "Cliente", target: "Marketing", type: "intangible", deliverable: "Insights de mercado y preferencias", value: 1}
                ];
                
                saveData();
                updateVisualization();
                document.getElementById('empty-state').style.display = 'none';
            }
            
            function clearAll() {
                if (links.length === 0) return;
                
                if (confirm(document.documentElement.lang === 'ca' ? 
                    'Est√†s segur que vols eliminar totes les transaccions?' : 
                    '¬øEst√°s seguro de que quieres eliminar todas las transacciones?')) {
                    nodes = [];
                    links = [];
                    saveData();
                    updateVisualization();
                    document.getElementById('empty-state').style.display = 'flex';
                }
            }
            
            function resetLayout() {
                if (simulation) {
                    simulation.alpha(1).restart();
                    document.getElementById('simulation-status').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('simulation-status').style.display = 'none';
                    }, 2000);
                }
            }
            
            function updateVisualization() {
                // Actualizar estad√≠sticas
                document.getElementById('node-count').textContent = nodes.length;
                document.getElementById('link-count').textContent = links.length;
                document.getElementById('tangible-count').textContent = links.filter(l => l.type === 'tangible').length;
                document.getElementById('intangible-count').textContent = links.filter(l => l.type === 'intangible').length;
                
                // Limpiar SVG
                svg.selectAll('*').remove();
                
                // Si no hay datos, mostrar mensaje
                if (nodes.length === 0) {
                    document.getElementById('empty-state').style.display = 'flex';
                    return;
                }
                
                document.getElementById('empty-state').style.display = 'none';
                
                // Crear simulaci√≥n de fuerza
                simulation = d3.forceSimulation(nodes)
                    .force('link', d3.forceLink(links).id(d => d.id).distance(180))
                    .force('charge', d3.forceManyBody().strength(-400))
                    .force('center', d3.forceCenter(width / 2, height / 2))
                    .force('collision', d3.forceCollide().radius(d => 70))
                    .alphaDecay(0.02)
                    .alphaMin(0.01)
                    .on('tick', ticked)
                    .on('end', () => {
                        document.getElementById('simulation-status').style.display = 'none';
                        isSimulationRunning = false;
                    });
                
                isSimulationRunning = true;
                document.getElementById('simulation-status').style.display = 'block';
                
                // Crear enlaces como paths para permitir curvatura
                const link = svg.append('g')
                    .attr('stroke-opacity', 0.9)
                    .selectAll('path')
                    .data(links)
                    .join('path')
                    .attr('class', 'link-path')
                    .attr('stroke-width', d => d.type === 'tangible' ? 3 : 2)
                    .attr('stroke', d => d.type === 'tangible' ? '#1e3a8a' : '#8b5cf6')
                    .attr('stroke-dasharray', d => d.type === 'intangible' ? '5,5' : '0')
                    .attr('fill', 'none')
                    .attr('marker-end', 'url(#arrowhead)');
                
                // Crear etiquetas de enlaces
                const linkLabelGroup = svg.append('g')
                    .attr('class', 'link-labels')
                    .selectAll('g')
                    .data(links)
                    .join('g')
                    .attr('class', 'link-label-group');
                
                const linkLabel = linkLabelGroup.append('text')
                    .attr('class', 'link-label')
                    .attr('dy', -15)
                    .attr('text-anchor', 'middle')
                    .html(d => {
                        // Dividir el entregable en l√≠neas si es muy largo
                        const words = d.deliverable.split(' ');
                        let lines = [];
                        let currentLine = '';
                        
                        words.forEach(word => {
                            if ((currentLine + ' ' + word).length > 20) {
                                lines.push(currentLine);
                                currentLine = word;
                            } else {
                                currentLine += (currentLine ? ' ' : '') + word;
                            }
                        });
                        
                        if (currentLine) lines.push(currentLine);
                        
                        return lines.map(line => `<tspan x="0" dy="1.2em">${line}</tspan>`).join('');
                    })
                    .attr('fill', '#4b5563')
                    .style('font-size', '10px');
                
                // Crear nodos
                const node = svg.append('g')
                    .attr('stroke', '#fff')
                    .attr('stroke-width', 3)
                    .selectAll('circle')
                    .data(nodes)
                    .join('circle')
                    .attr('r', 50)
                    .attr('fill', d => {
                        // Contar conexiones del nodo
                        const connections = links.filter(l => l.source.id === d.id || l.target.id === d.id).length;
                        return connections > 3 ? '#1e3a8a' : '#4f46e5';
                    })
                    .call(d3.drag()
                        .on('start', dragstarted)
                        .on('drag', dragged)
                        .on('end', dragended));
                
                // Crear etiquetas de nodos
                const label = svg.append('g')
                    .attr('text-anchor', 'middle')
                    .attr('dominant-baseline', 'middle')
                    .selectAll('text')
                    .data(nodes)
                    .join('text')
                    .text(d => d.id)
                    .attr('fill', '#0f172a')
                    .attr('font-weight', '700')
                    .attr('font-size', '14px')
                    .call(d3.drag()
                        .on('start', dragstarted)
                        .on('drag', dragged)
                        .on('end', dragended));
                
                // Tooltip para enlaces
                linkLabelGroup.on('mouseover', function(event, d) {
                    const tooltip = document.getElementById('tooltip');
                    tooltip.innerHTML = `
                        <h4>${document.documentElement.lang === 'ca' ? 'Transacci√≥ de Valor' : 'Transacci√≥n de Valor'}</h4>
                        <p><span class="label">${document.documentElement.lang === 'ca' ? 'Origen:' : 'Origen:'}</span> <span class="value">${d.source.id}</span></p>
                        <p><span class="label">${document.documentElement.lang === 'ca' ? 'Dest√≠:' : 'Destino:'}</span> <span class="value">${d.target.id}</span></p>
                        <p><span class="label">${document.documentElement.lang === 'ca' ? 'Tipus:' : 'Tipo:'}</span> <span class="type-badge ${d.type}">${d.type.charAt(0).toUpperCase() + d.type.slice(1)}</span></p>
                        <p><span class="label">${document.documentElement.lang === 'ca' ? 'Entregable:' : 'Entregable:'}</span> <span class="value">${d.deliverable}</span></p>
                    `;
                    tooltip.style.display = 'block';
                    tooltip.style.left = (event.pageX + 15) + 'px';
                    tooltip.style.top = (event.pageY + 15) + 'px';
                })
                .on('mouseout', () => {
                    document.getElementById('tooltip').style.display = 'none';
                });
                
                // Tooltip para nodos
                node.on('mouseover', function(event, d) {
                    // Contar conexiones entrantes y salientes
                    const incoming = links.filter(l => l.target.id === d.id).length;
                    const outgoing = links.filter(l => l.source.id === d.id).length;
                    const total = incoming + outgoing;
                    
                    const tooltip = document.getElementById('tooltip');
                    tooltip.innerHTML = `
                        <h4>${d.id}</h4>
                        <p><span class="label">${document.documentElement.lang === 'ca' ? 'Connexions totals:' : 'Conexiones totales:'}</span> <span class="value">${total}</span></p>
                        <p><span class="label">${document.documentElement.lang === 'ca' ? 'Entrants:' : 'Entrantes:'}</span> <span class="value">${incoming}</span></p>
                        <p><span class="label">${document.documentElement.lang === 'ca' ? 'Sortints:' : 'Salientes:'}</span> <span class="value">${outgoing}</span></p>
                        <p><span class="label">${document.documentElement.lang === 'ca' ? 'Import√†ncia a la xarxa:' : 'Importancia en la red:'}</span> <span class="value">${total > 5 ? (document.documentElement.lang === 'ca' ? 'Alta' : 'Alta') : total > 2 ? (document.documentElement.lang === 'ca' ? 'Mitjana' : 'Media') : (document.documentElement.lang === 'ca' ? 'Baixa' : 'Baja')}</span></p>
                    `;
                    tooltip.style.display = 'block';
                    tooltip.style.left = (event.pageX + 15) + 'px';
                    tooltip.style.top = (event.pageY + 15) + 'px';
                })
                .on('mouseout', () => {
                    document.getElementById('tooltip').style.display = 'none';
                });
                
                // Funci√≥n tick para actualizar posiciones
                function ticked() {
                    // Calcular el √≠ndice de cada enlace entre el mismo par de nodos
                    const linkMap = new Map();
                    links.forEach((link, i) => {
                        const key = `${link.source.id}-${link.target.id}`;
                        if (!linkMap.has(key)) linkMap.set(key, []);
                        linkMap.get(key).push(i);
                    });
                    
                    // Actualizar posici√≥n de los enlaces
                    link.attr('d', d => {
                        const sourceNode = typeof d.source === 'object' ? d.source : nodes.find(n => n.id === d.source);
                        const targetNode = typeof d.target === 'object' ? d.target : nodes.find(n => n.id === d.target);
                        
                        if (!sourceNode || !targetNode) return 'M0,0L0,0';
                        
                        // Calcular curvatura basada en el √≠ndice del enlace
                        const key = `${d.source.id}-${d.target.id}`;
                        const linkGroup = linkMap.get(key) || [];
                        const linkIndex = linkGroup.indexOf(links.indexOf(d));
                        const curvature = (linkIndex - (linkGroup.length - 1) / 2) * 0.2;
                        
                        // Calcular puntos de control para la curva
                        const dx = targetNode.x - sourceNode.x;
                        const dy = targetNode.y - sourceNode.y;
                        const dr = Math.sqrt(dx * dx + dy * dy) * Math.abs(curvature);
                        
                        return `M${sourceNode.x},${sourceNode.y}A${dr},${dr} 0 0,${curvature > 0 ? 1 : 0} ${targetNode.x},${targetNode.y}`;
                    });
                    
                    // Actualizar posici√≥n de las etiquetas
                    linkLabelGroup.attr('transform', d => {
                        const sourceNode = typeof d.source === 'object' ? d.source : nodes.find(n => n.id === d.source);
                        const targetNode = typeof d.target === 'object' ? d.target : nodes.find(n => n.id === d.target);
                        
                        if (!sourceNode || !targetNode) return 'translate(0,0)';
                        
                        // Posicionar la etiqueta en el centro del enlace curvado
                        const x = (sourceNode.x + targetNode.x) / 2;
                        const y = (sourceNode.y + targetNode.y) / 2;
                        
                        // Ajustar verticalmente seg√∫n la curvatura
                        const key = `${d.source.id}-${d.target.id}`;
                        const linkGroup = linkMap.get(key) || [];
                        const linkIndex = linkGroup.indexOf(links.indexOf(d));
                        const offset = (linkIndex - (linkGroup.length - 1) / 2) * 25;
                        
                        return `translate(${x},${y + offset})`;
                    });
                    
                    // Actualizar posici√≥n de nodos y etiquetas
                    node
                        .attr('cx', d => d.x = Math.max(60, Math.min(width - 60, d.x)))
                        .attr('cy', d => d.y = Math.max(60, Math.min(height - 60, d.y)));
                    
                    label
                        .attr('x', d => d.x)
                        .attr('y', d => d.y);
                }
                
                // Funciones de drag
                function dragstarted(event, d) {
                    if (!event.active) simulation.alpha(0.3).restart();
                    d.fx = d.x;
                    d.fy = d.y;
                }
                
                function dragged(event, d) {
                    d.fx = event.x;
                    d.fy = event.y;
                }
                
                function dragended(event, d) {
                    if (!event.active) simulation.alpha(0.001);
                    d.fx = null;
                    d.fy = null;
                }
                
                // Guardar referencia a g para el zoom
                g = svg;
            }
            
            function resetZoom() {
                svg.transition()
                    .duration(300)
                    .call(zoom.transform, d3.zoomIdentity);
            }
            
            function fitToScreen() {
                // Calcular bounding box de todos los elementos
                const bbox = svg.node().getBBox();
                
                if (bbox.width === 0 || bbox.height === 0) return;
                
                // Calcular escala y traslaci√≥n
                const padding = 80;
                const scaleX = (width - padding * 2) / bbox.width;
                const scaleY = (height - padding * 2) / bbox.height;
                const scale = Math.min(scaleX, scaleY, 2); // M√°ximo zoom 2x
                
                const translateX = (width - bbox.width * scale) / 2 - bbox.x * scale;
                const translateY = (height - bbox.height * scale) / 2 - bbox.y * scale;
                
                // Aplicar transformaci√≥n
                svg.transition()
                    .duration(500)
                    .call(zoom.transform, d3.zoomIdentity
                        .translate(translateX, translateY)
                        .scale(scale));
            }
            
            function saveData() {
                const data = {nodes, links};
                localStorage.setItem('vnaData', JSON.stringify(data));
            }
            
            function loadSavedData() {
                const saved = localStorage.getItem('vnaData');
                if (saved) {
                    const data = JSON.parse(saved);
                    nodes = data.nodes || [];
                    links = data.links || [];
                    
                    if (nodes.length > 0 || links.length > 0) {
                        document.getElementById('empty-state').style.display = 'none';
                    }
                }
            }
            
            function exportPNG() {
                if (nodes.length === 0) {
                    alert(document.documentElement.lang === 'ca' ? 
                        'No hi ha dades per exportar' : 
                        'No hay datos para exportar');
                    return;
                }
                
                // Mostrar estado de carga
                const originalText = document.getElementById('export-png').innerHTML;
                document.getElementById('export-png').innerHTML = '<span>‚è≥</span> ' + (document.documentElement.lang === 'ca' ? 'Generant PNG...' : 'Generando PNG...');
                document.getElementById('export-png').disabled = true;
                
                // Crear un contenedor temporal para la exportaci√≥n
                const exportContainer = document.createElement('div');
                exportContainer.style.width = '1600px';
                exportContainer.style.height = '1200px';
                exportContainer.style.position = 'absolute';
                exportContainer.style.left = '-9999px';
                document.body.appendChild(exportContainer);
                
                // Crear SVG para exportaci√≥n
                const exportSvg = d3.select(exportContainer)
                    .append('svg')
                    .attr('width', 1600)
                    .attr('height', 1200)
                    .style('background', 'white');
                
                // Copiar contenido del SVG actual
                const svgNode = document.querySelector('#vna-svg svg');
                const clone = svgNode.cloneNode(true);
                exportSvg.node().appendChild(clone);
                
                // Ajustar estilos para exportaci√≥n
                exportSvg.selectAll('circle')
                    .attr('stroke', '#fff')
                    .attr('stroke-width', 4);
                
                exportSvg.selectAll('text')
                    .attr('fill', '#0f172a')
                    .attr('font-family', 'Arial, sans-serif');
                
                // Agregar t√≠tulo y leyenda
                exportSvg.append('text')
                    .attr('x', 800)
                    .attr('y', 40)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '24')
                    .attr('font-weight', 'bold')
                    .attr('fill', '#1e3a8a')
                    .text('Value Network Analysis - TeamTowers Hum√†');
                
                exportSvg.append('text')
                    .attr('x', 800)
                    .attr('y', 80)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '16')
                    .attr('fill', '#4b5563')
                    .text(`Roles: ${nodes.length} | Transacciones: ${links.length} | Tangibles: ${links.filter(l => l.type === 'tangible').length} | Intangibles: ${links.filter(l => l.type === 'intangible').length}`);
                
                // Agregar leyenda
                exportSvg.append('rect')
                    .attr('x', 50)
                    .attr('y', 1100)
                    .attr('width', 250)
                    .attr('height', 70)
                    .attr('fill', '#f8fafc')
                    .attr('stroke', '#e2e8f0');
                
                exportSvg.append('line')
                    .attr('x1', 60)
                    .attr('y1', 1120)
                    .attr('x2', 100)
                    .attr('y2', 1120)
                    .attr('stroke', '#1e3a8a')
                    .attr('stroke-width', 4);
                
                exportSvg.append('text')
                    .attr('x', 110)
                    .attr('y', 1125)
                    .attr('font-size', '14')
                    .attr('fill', '#4b5563')
                    .text(document.documentElement.lang === 'ca' ? 'Tangible (b√©ns, serveis, dades)' : 'Tangible (bienes, servicios, datos)');
                
                exportSvg.append('line')
                    .attr('x1', 60)
                    .attr('y1', 1145)
                    .attr('x2', 100)
                    .attr('y2', 1145)
                    .attr('stroke', '#8b5cf6')
                    .attr('stroke-width', 3)
                    .attr('stroke-dasharray', '5,5');
                
                exportSvg.append('text')
                    .attr('x', 110)
                    .attr('y', 1150)
                    .attr('font-size', '14')
                    .attr('fill', '#4b5563')
                    .text(document.documentElement.lang === 'ca' ? 'Intangible (confian√ßa, coneixement)' : 'Intangible (confianza, conocimiento)');
                
                // Convertir a canvas y luego a PNG
                html2canvas(exportContainer, {
                    scale: 2,
                    backgroundColor: '#ffffff',
                    logging: false
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `vna-teamtowers-huma-${new Date().toISOString().slice(0,10)}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    
                    // Limpiar
                    document.body.removeChild(exportContainer);
                    document.getElementById('export-png').innerHTML = originalText;
                    document.getElementById('export-png').disabled = false;
                    
                    alert(document.documentElement.lang === 'ca' ? 
                        'Mapa exportat correctament com a PNG' : 
                        'Mapa exportado exitosamente como PNG');
                }).catch(err => {
                    console.error('Error al exportar PNG:', err);
                    alert(document.documentElement.lang === 'ca' ? 
                        'Error en generar la imatge. Torna-ho a provar.' : 
                        'Error al generar la imagen. Por favor intenta de nuevo.');
                    document.body.removeChild(exportContainer);
                    document.getElementById('export-png').innerHTML = originalText;
                    document.getElementById('export-png').disabled = false;
                });
            }
            
            function exportSVG() {
                if (nodes.length === 0) {
                    alert(document.documentElement.lang === 'ca' ? 
                        'No hi ha dades per exportar' : 
                        'No hay datos para exportar');
                    return;
                }
                
                // Crear SVG para exportaci√≥n
                const exportSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                exportSvg.setAttribute('width', '1600');
                exportSvg.setAttribute('height', '1200');
                exportSvg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
                exportSvg.style.backgroundColor = 'white';
                
                // Copiar contenido del SVG actual
                const svgNode = document.querySelector('#vna-svg svg');
                const clone = svgNode.cloneNode(true);
                
                // A√±adir estilos inline para mejor compatibilidad
                const style = document.createElementNS('http://www.w3.org/2000/svg', 'style');
                style.textContent = `
                    .node { stroke: #fff; stroke-width: 4; }
                    .link-path { marker-end: url(#arrowhead); }
                    .link-tangible { stroke: #1e3a8a; stroke-width: 3; }
                    .link-intangible { stroke: #8b5cf6; stroke-width: 2; stroke-dasharray: 5,5; }
                    text { fill: #0f172a; font-family: Arial, sans-serif; font-weight: bold; }
                    .link-label { font-size: 10px; fill: #4b5563; }
                `;
                exportSvg.appendChild(style);
                
                // A√±adir t√≠tulo y estad√≠sticas
                const title = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                title.setAttribute('x', '800');
                title.setAttribute('y', '40');
                title.setAttribute('text-anchor', 'middle');
                title.setAttribute('font-size', '24');
                title.setAttribute('font-weight', 'bold');
                title.setAttribute('fill', '#1e3a8a');
                title.textContent = 'Value Network Analysis - TeamTowers Hum√†';
                exportSvg.appendChild(title);
                
                const stats = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                stats.setAttribute('x', '800');
                stats.setAttribute('y', '80');
                stats.setAttribute('text-anchor', 'middle');
                stats.setAttribute('font-size', '16');
                stats.setAttribute('fill', '#4b5563');
                stats.textContent = `Roles: ${nodes.length} | Transacciones: ${links.length} | Tangibles: ${links.filter(l => l.type === 'tangible').length} | Intangibles: ${links.filter(l => l.type === 'intangible').length}`;
                exportSvg.appendChild(stats);
                
                // A√±adir leyenda
                const legendRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                legendRect.setAttribute('x', '50');
                legendRect.setAttribute('y', '1100');
                legendRect.setAttribute('width', '250');
                legendRect.setAttribute('height', '70');
                legendRect.setAttribute('fill', '#f8fafc');
                legendRect.setAttribute('stroke', '#e2e8f0');
                exportSvg.appendChild(legendRect);
                
                const line1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line1.setAttribute('x1', '60');
                line1.setAttribute('y1', '1120');
                line1.setAttribute('x2', '100');
                line1.setAttribute('y2', '1120');
                line1.setAttribute('stroke', '#1e3a8a');
                line1.setAttribute('stroke-width', '4');
                exportSvg.appendChild(line1);
                
                const text1 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text1.setAttribute('x', '110');
                text1.setAttribute('y', '1125');
                text1.setAttribute('font-size', '14');
                text1.setAttribute('fill', '#4b5563');
                text1.textContent = document.documentElement.lang === 'ca' ? 'Tangible (b√©ns, serveis, dades)' : 'Tangible (bienes, servicios, datos)';
                exportSvg.appendChild(text1);
                
                const line2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line2.setAttribute('x1', '60');
                line2.setAttribute('y1', '1145');
                line2.setAttribute('x2', '100');
                line2.setAttribute('y2', '1145');
                line2.setAttribute('stroke', '#8b5cf6');
                line2.setAttribute('stroke-width', '3');
                line2.setAttribute('stroke-dasharray', '5,5');
                exportSvg.appendChild(line2);
                
                const text2 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text2.setAttribute('x', '110');
                text2.setAttribute('y', '1150');
                text2.setAttribute('font-size', '14');
                text2.setAttribute('fill', '#4b5563');
                text2.textContent = document.documentElement.lang === 'ca' ? 'Intangible (confian√ßa, coneixement)' : 'Intangible (confianza, conocimiento)';
                exportSvg.appendChild(text2);
                
                // A√±adir contenido del grafo
                exportSvg.appendChild(clone);
                
                // Crear enlace de descarga
                const serializer = new XMLSerializer();
                let source = serializer.serializeToString(exportSvg);
                source = '<?xml version="1.0" standalone="no"?>\r\n' + source;
                const url = 'image/svg+xml;charset=utf-8,' + encodeURIComponent(source);
                
                const link = document.createElement('a');
                link.download = `vna-teamtowers-huma-${new Date().toISOString().slice(0,10)}.svg`;
                link.href = url;
                link.click();
                
                alert(document.documentElement.lang === 'ca' ? 
                    'Mapa exportat correctament com a SVG' : 
                    'Mapa exportado exitosamente como SVG');
            }
            
            function exportJSON() {
                if (nodes.length === 0) {
                    alert(document.documentElement.lang === 'ca' ? 
                        'No hi ha dades per exportar' : 
                        'No hay datos para exportar');
                    return;
                }
                
                const dataStr = JSON.stringify({nodes, links}, null, 2);
                const dataUri = 'application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `vna-data-teamtowers-huma-${new Date().toISOString().slice(0,10)}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                alert(document.documentElement.lang === 'ca' ? 
                    'Dades exportades correctament com a JSON' : 
                    'Datos exportados exitosamente como JSON');
            }
            
            function copyData() {
                if (nodes.length === 0) {
                    alert(document.documentElement.lang === 'ca' ? 
                        'No hi ha dades per copiar' : 
                        'No hay datos para copiar');
                    return;
                }
                
                // Formatear datos como texto legible
                let text = 'VALUE NETWORK ANALYSIS - TEAMTOWERS HUM√Ä\n';
                text += `Data: ${new Date().toLocaleDateString()}\n`;
                text += `Roles: ${nodes.length} | Transaccions: ${links.length}\n\n`;
                text += 'TRANSACCIONS:\n';
                text += '='.repeat(80) + '\n';
                
                links.forEach((link, i) => {
                    text += `${i+1}. ${link.source.id} ‚Üí ${link.target.id} | ${link.type} | ${link.deliverable}\n`;
                });
                
                text += '='.repeat(80) + '\n';
                text += `\nTotal de transaccions: ${links.length}`;
                
                // Copiar al portapapeles
                navigator.clipboard.writeText(text).then(() => {
                    alert(document.documentElement.lang === 'ca' ? 
                        'Dades copiades al porta-retalls correctament' : 
                        'Datos copiados al portapapeles exitosamente');
                    
                    // Efecto visual de confirmaci√≥n
                    const btn = document.getElementById('copy-data');
                    const originalText = btn.innerHTML;
                    btn.innerHTML = '<span>‚úÖ</span> ' + (document.documentElement.lang === 'ca' ? '¬°Copiat!' : '¬°Copiado!');
                    btn.style.background = 'linear-gradient(135deg, #10b981 0%, #0da27f 100%)';
                    
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.style.background = '';
                    }, 2000);
                }).catch(err => {
                    console.error('Error al copiar:', err);
                    alert(document.documentElement.lang === 'ca' ? 
                        'Error en copiar les dades. Selecciona i copia manualment.' : 
                        'Error al copiar los datos. Por favor selecciona y copia manualmente.');
                });
            }
            
            function updateEmptyState() {
                if (nodes.length === 0 && links.length === 0) {
                    document.getElementById('empty-state').style.display = 'flex';
                } else {
                    document.getElementById('empty-state').style.display = 'none';
                }
            }
        }
    </script>
</body>
</html>
