<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Value Accounting App | TeamTowers Hum√†. Sistema de contabilidad de valor para tokenizar contribuciones y visualizar la distribuci√≥n del valor en tiempo real">
    <meta name="keywords" content="Contabilidad de Valor, Value Accounting, tokenizaci√≥n, TeamTowers Hum√†, Vilafranca del Pened√®s, innovaci√≥n financiera">
    <meta name="author" content="TeamTowers Hum√†">
    <meta name="robots" content="index, follow">
    <title>Value Accounting App | TeamTowers Hum√†</title>
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="Value Accounting App | TeamTowers Hum√†">
    <meta property="og:description" content="Sistema de contabilidad de valor para tokenizar contribuciones y visualizar la distribuci√≥n del valor en tiempo real">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://teamtowershuma.com/app_comptabilitat">
    <meta property="og:image" content="https://raw.githubusercontent.com/asolache/Teamtowers/main/images/logoteamtowers.png">
    <meta property="og:locale" content="es_ES">
    <meta property="og:locale:alternate" content="ca_ES">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Value Accounting App | TeamTowers Hum√†">
    <meta name="twitter:description" content="Visualiza en tiempo real c√≥mo se distribuye el valor entre stakeholders de tu proyecto">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/asolache/Teamtowers/main/images/logoteamtowers.png">
    
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary: #1e3a8a; /* Azul TeamTowers */
            --secondary: #4f46e5; /* Azul m√°s claro */
            --accent: #8b5cf6; /* Morado TeamTowers */
            --dark: #0f172a;
            --light: #f8fafc;
            --gold: #f59e0b;
            --success: #10b981;
            --warning: #fbbf24;
            --danger: #ef4444;
            --gray: #64748b;
            --border-radius: 12px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #fff;
            overflow-x: hidden;
        }
        
        /* Language Selector */
        .language-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 50px;
            padding: 5px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 5px;
        }
        
        .lang-btn {
            padding: 8px 16px;
            border: none;
            background: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .lang-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(30, 58, 138, 0.3);
        }
        
        /* Header */
        header {
            background: linear-gradient(135deg, var(--dark) 0%, #1e293b 100%);
            color: white;
            padding: 20px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
            z-index: 10;
        }
        
        .header-logo {
            height: 60px;
            margin-bottom: 15px;
            filter: drop-shadow(0 4px 10px rgba(0,0,0,0.3));
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .tagline {
            font-size: 1.4rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        /* Main Content */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        @media (max-width: 992px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            height: fit-content;
        }
        
        .panel h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel h2::before {
            content: '';
            display: inline-block;
            width: 8px;
            height: 24px;
            background: var(--accent);
            border-radius: 4px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .input-group label::before {
            content: '‚Ä¢';
            color: var(--accent);
            font-size: 24px;
            line-height: 1;
        }
        
        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.2);
        }
        
        .input-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .btn-group {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.05rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }
        
        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #0da27f 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #b91c1c 100%);
            color: white;
        }
        
        .btn-export {
            background: linear-gradient(135deg, #7e3af2 0%, #4f46e5 100%);
            color: white;
            grid-column: span 2;
        }
        
        .visualization-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            position: relative;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 30px;
        }
        
        .ranking-container {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .ranking-header {
            background: var(--light);
            padding: 15px;
            font-weight: 700;
            border-bottom: 2px solid var(--accent);
            display: grid;
            grid-template-columns: 40px 1fr 150px 120px 120px;
            gap: 15px;
        }
        
        .ranking-item {
            padding: 12px 15px;
            border-bottom: 1px solid #e2e8f0;
            display: grid;
            grid-template-columns: 40px 1fr 150px 120px 120px;
            gap: 15px;
            align-items: center;
            transition: var(--transition);
        }
        
        .ranking-item:hover {
            background: #f1f5f9;
        }
        
        .ranking-item:nth-child(odd) {
            background: #f8fafc;
        }
        
        .ranking-badge {
            display: inline-block;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
        }
        
        .role-tag {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-right: 5px;
            margin-top: 8px;
        }
        
        .role-team {
            background: rgba(16, 185, 129, 0.15);
            color: #0d9488;
        }
        
        .role-client {
            background: rgba(30, 58, 138, 0.15);
            color: #1e3a8a;
        }
        
        .role-supplier {
            background: rgba(139, 92, 246, 0.15);
            color: #7e3af2;
        }
        
        .role-investor {
            background: rgba(245, 158, 11, 0.15);
            color: #b45309;
        }
        
        .value-amount {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.1rem;
        }
        
        .wallet-address {
            font-family: monospace;
            font-size: 0.85rem;
            color: var(--gray);
            word-break: break-all;
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: linear-gradient(135deg, var(--light) 0%, #e0e7ff 100%);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 15px;
            border: 1px solid rgba(30, 58, 138, 0.1);
        }
        
        .stat-item {
            text-align: center;
            min-width: 100px;
            padding: 8px 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--gray);
            margin-top: 3px;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 5px;
        }
        
        .badge-tangible {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .badge-intangible {
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
        }
        
        .transaction-form {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }
        
        .transaction-form h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .quick-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .quick-input input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
        }
        
        .quick-input .btn {
            padding: 10px 15px;
            min-width: auto;
        }
        
        .deliverable-input {
            margin-top: 15px;
        }
        
        .deliverable-input textarea {
            min-height: 60px;
        }
        
        .value-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .value-input input {
            max-width: 120px;
        }
        
        .value-input span {
            font-weight: 600;
            color: var(--primary);
        }
        
        .user-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }
        
        .user-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .user-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .user-card {
            background: var(--light);
            border-radius: 8px;
            padding: 12px;
            border-left: 3px solid var(--accent);
        }
        
        .user-card h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
            color: var(--primary);
        }
        
        .user-card .wallet {
            font-size: 0.8rem;
            color: var(--gray);
            word-break: break-all;
        }
        
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 20px;
            color: var(--gray);
        }
        
        .empty-state svg {
            width: 120px;
            height: 120px;
            margin-bottom: 20px;
            color: var(--accent);
            opacity: 0.7;
        }
        
        .empty-state h3 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .empty-state p {
            max-width: 500px;
            margin-bottom: 25px;
            line-height: 1.7;
        }
        
        .import-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid var(--accent);
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.05) 0%, rgba(255, 255, 255, 0) 100%);
            border-radius: var(--border-radius);
        }
        
        .import-section h3 {
            color: var(--gold);
            margin-bottom: 15px;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .import-section h3::before {
            content: 'üìä';
            font-size: 1.4rem;
        }
        
        /* Footer */
        footer {
            background: var(--dark);
            color: rgba(255, 255, 255, 0.85);
            padding: 60px 20px 30px;
            margin-top: 60px;
        }
        
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .footer-col h3 {
            color: white;
            font-size: 1.6rem;
            margin-bottom: 25px;
            position: relative;
            padding-bottom: 10px;
        }
        
        .footer-col h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 3px;
            background: var(--accent);
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 12px;
        }
        
        .footer-links a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: var(--transition);
            display: block;
            padding: 5px 0;
            font-size: 1.05rem;
        }
        
        .footer-links a:hover {
            color: var(--accent);
            transform: translateX(5px);
        }
        
        .copyright {
            text-align: center;
            padding-top: 40px;
            margin-top: 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .tagline {
                font-size: 1.1rem;
            }
            
            .panel {
                padding: 20px;
            }
            
            .ranking-header,
            .ranking-item {
                grid-template-columns: 35px 1fr 120px 100px 100px;
                font-size: 0.9rem;
            }
            
            .value-input {
                flex-direction: column;
                align-items: flex-start;
            }
        }
        
        @media (max-width: 480px) {
            .language-selector {
                top: 15px;
                right: 15px;
                padding: 3px;
            }
            
            .header-logo {
                height: 50px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .tagline {
                font-size: 1rem;
            }
            
            .container {
                padding: 20px 15px;
            }
            
            .btn {
                padding: 12px 15px;
                font-size: 0.95rem;
            }
            
            .chart-container {
                height: 300px;
            }
            
            .ranking-header,
            .ranking-item {
                grid-template-columns: 30px 1fr 100px 80px 80px;
                font-size: 0.85rem;
                padding: 8px 10px;
            }
            
            .quick-input {
                flex-direction: column;
            }
            
            .quick-input input {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Language Selector -->
    <div class="language-selector">
        <button class="lang-btn active" data-lang="es">ES</button>
        <button class="lang-btn" data-lang="ca">CA</button>
    </div>
    
    <!-- Header -->
    <header>
        <div class="header-content">
            <img src="https://raw.githubusercontent.com/asolache/Teamtowers/main/images/logoteamtowers.png" alt="TeamTowers Hum√†" class="header-logo">
            <h1 class="lang" data-es="Value Accounting App" data-ca="Aplicaci√≥ Comptabilitat de Valor">Value Accounting App</h1>
            <p class="tagline lang" data-es="Sistema de contabilidad de valor para tokenizar contribuciones y visualizar la distribuci√≥n del valor en tiempo real" data-ca="Sistema de comptabilitat de valor per tokenitzar contribucions i visualitzar la distribuci√≥ del valor en temps real">Sistema de contabilidad de valor para tokenizar contribuciones y visualizar la distribuci√≥n del valor en tiempo real</p>
        </div>
    </header>
    
    <!-- Main Content -->
    <div class="container">
        <div class="app-container">
            <div class="panel">
                <h2 class="lang" data-es="‚öôÔ∏è Configuraci√≥n del Proyecto" data-ca="‚öôÔ∏è Configuraci√≥ del Projecte">‚öôÔ∏è Configuraci√≥n del Proyecto</h2>
                <div class="input-group">
                    <label class="lang" data-es="Nombre del Proyecto" data-ca="Nom del Projecte">Nombre del Proyecto</label>
                    <input type="text" id="project-name" placeholder="Ej: Proyecto Innovaci√≥n 2024">
                </div>
                <div class="input-group">
                    <label class="lang" data-es="Moneda de Valor" data-ca="Moneda de Valor">Moneda de Valor</label>
                    <select id="value-currency">
                        <option value="puntos" class="lang" data-es="Puntos de Valor" data-ca="Punts de Valor">Puntos de Valor</option>
                        <option value="tokens" class="lang" data-es="Tokens (futuro)" data-ca="Tokens (futur)">Tokens (futuro)</option>
                        <option value="euros" class="lang" data-es="Euros (‚Ç¨)" data-ca="Euros (‚Ç¨)">Euros (‚Ç¨)</option>
                    </select>
                </div>
                
                <div class="panel" style="margin-top: 20px;">
                    <h2 class="lang" data-es="üì• Importar Mapa de Valor" data-ca="üì• Importar Mapa de Valor">üì• Importar Mapa de Valor</h2>
                    <div class="input-group">
                        <label class="lang" data-es="Importar desde VNA App" data-ca="Importar des de VNA App">Importar desde VNA App</label>
                        <input type="file" id="import-file" accept=".json">
                    </div>
                    <div class="btn-group">
                        <button id="import-data" class="btn btn-primary">
                            <span>üì§</span> <span class="lang" data-es="Importar Datos" data-ca="Importar Dades">Importar Datos</span>
                        </button>
                    </div>
                    
                    <div class="import-section">
                        <h3 class="lang" data-es="Asignaci√≥n de Usuarios a Roles" data-ca="Assignaci√≥ d'Usuaris a Rols">Asignaci√≥n de Usuarios a Roles</h3>
                        <p class="lang" data-es="Despu√©s de importar el mapa de valor, asigna usuarios a cada rol para poder registrar sus entregables y asociar wallets Ethereum para futura tokenizaci√≥n." data-ca="Despr√©s d'importar el mapa de valor, assigna usuaris a cada rol per poder registrar els seus entregables i associar wallets Ethereum per a futura tokenitzaci√≥.">Despu√©s de importar el mapa de valor, asigna usuarios a cada rol para poder registrar sus entregables y asociar wallets Ethereum para futura tokenizaci√≥n.</p>
                        
                        <div id="role-user-assignment" style="display: none; margin-top: 15px;">
                            <h4 class="lang" data-es="Roles Detectados" data-ca="Rols Detectats">Roles Detectados</h4>
                            <div id="roles-container"></div>
                        </div>
                    </div>
                </div>
                
                <div class="panel" style="margin-top: 20px;">
                    <h2 class="lang" data-es="‚ûï A√±adir Entregable" data-ca="‚ûï Afegir Entregable">‚ûï A√±adir Entregable</h2>
                    <div class="quick-input">
                        <input type="text" id="quick-input" placeholder="@rol #entregable valor:100">
                        <button id="quick-add" class="btn btn-success">+</button>
                    </div>
                    <p class="lang" data-es="Formato r√°pido: <code>@rol #entregable valor:100</code>" data-ca="Format r√†pid: <code>@rol #entregable valor:100</code>">Formato r√°pido: <code>@rol #entregable valor:100</code></p>
                    
                    <div class="transaction-form">
                        <h3 class="lang" data-es="Formulario Detallado" data-ca="Formulari Detallat">Formulario Detallado</h3>
                        <div class="input-group">
                            <label class="lang" data-es="Rol (@nombre)" data-ca="Rol (@nom)">Rol (@nombre)</label>
                            <select id="role-select">
                                <option class="lang" data-es="Selecciona un rol" data-ca="Selecciona un rol">Selecciona un rol</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="lang" data-es="Usuario" data-ca="Usuari">Usuario</label>
                            <select id="user-select">
                                <option class="lang" data-es="Selecciona un usuario" data-ca="Selecciona un usuari">Selecciona un usuario</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="lang" data-es="Entregable (#etiqueta)" data-ca="Entregable (#etiqueta)">Entregable (#etiqueta)</label>
                            <input type="text" id="deliverable-input" placeholder="#informe-semanal">
                        </div>
                        <div class="deliverable-input">
                            <label class="lang" data-es="Descripci√≥n" data-ca="Descripci√≥">Descripci√≥n</label>
                            <textarea id="description-input" placeholder="Informe detallado de m√©tricas de campa√±a"></textarea>
                        </div>
                        <div class="input-group">
                            <label class="lang" data-es="Enlace (opcional)" data-ca="Enlla√ß (opcional)">Enlace (opcional)</label>
                            <input type="url" id="link-input" placeholder="https://ejemplo.com/informe.pdf">
                        </div>
                        <div class="value-input">
                            <span class="lang" data-es="Valor:" data-ca="Valor:">Valor:</span>
                            <input type="number" id="value-input" placeholder="100" min="1">
                        </div>
                        <div class="btn-group">
                            <button id="add-deliverable" class="btn btn-primary">
                                <span>‚ú®</span> <span class="lang" data-es="Registrar Entregable" data-ca="Registrar Entregable">Registrar Entregable</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="user-section">
                        <h3 class="lang" data-es="üë• Gesti√≥n de Usuarios" data-ca="üë• Gesti√≥ d'Usuaris">üë• Gesti√≥n de Usuarios</h3>
                        <p class="lang" data-es="A√±ade usuarios a los roles para poder registrar sus entregables y asociar wallets Ethereum." data-ca="Afegeix usuaris als rols per poder registrar els seus entregables i associar wallets Ethereum.">A√±ade usuarios a los roles para poder registrar sus entregables y asociar wallets Ethereum.</p>
                        
                        <div class="input-group">
                            <label class="lang" data-es="Nombre de Usuario" data-ca="Nom d'Usuari">Nombre de Usuario</label>
                            <input type="text" id="new-user-name" placeholder="Ej: Mar√≠a Garc√≠a">
                        </div>
                        <div class="input-group">
                            <label class="lang" data-es="Wallet Ethereum (opcional)" data-ca="Wallet Ethereum (opcional)">Wallet Ethereum (opcional)</label>
                            <input type="text" id="new-user-wallet" placeholder="0x...">
                        </div>
                        <div class="input-group">
                            <label class="lang" data-es="Rol Asignado" data-ca="Rol Assignat">Rol Asignado</label>
                            <select id="new-user-role">
                                <option class="lang" data-es="Selecciona un rol" data-ca="Selecciona un rol">Selecciona un rol</option>
                            </select>
                        </div>
                        <div class="btn-group">
                            <button id="add-user" class="btn btn-success">
                                <span>üë§</span> <span class="lang" data-es="A√±adir Usuario" data-ca="Afegir Usuari">A√±adir Usuario</span>
                            </button>
                        </div>
                        
                        <div class="user-grid" id="user-grid">
                            <!-- Users will be added here dynamically -->
                        </div>
                    </div>
                </div>
                
                <div class="panel" style="margin-top: 20px;">
                    <h2 class="lang" data-es="üíæ Exportar Datos" data-ca="üíæ Exportar Dades">üíæ Exportar Datos</h2>
                    <div class="btn-group">
                        <button id="export-json" class="btn btn-export">
                            <span>üìä</span> <span class="lang" data-es="Exportar JSON" data-ca="Exportar JSON">Exportar JSON</span>
                        </button>
                        <button id="export-csv" class="btn btn-export">
                            <span>üìà</span> <span class="lang" data-es="Exportar CSV" data-ca="Exportar CSV">Exportar CSV</span>
                        </button>
                        <button id="reset-data" class="btn btn-danger">
                            <span>üóëÔ∏è</span> <span class="lang" data-es="Limpiar Datos" data-ca="Netejar Dades">Limpiar Datos</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="visualization-container">
                <h2>üìä <span class="lang" data-es="Distribuci√≥n de Valor en Tiempo Real" data-ca="Distribuci√≥ de Valor en Temps Real">Distribuci√≥n de Valor en Tiempo Real</span></h2>
                <div class="chart-container">
                    <canvas id="valueChart"></canvas>
                </div>
                
                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-value" id="total-value">0</div>
                        <div class="stat-label lang" data-es="Valor Total" data-ca="Valor Total">Valor Total</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="total-deliverables">0</div>
                        <div class="stat-label lang" data-es="Entregables" data-ca="Entregables">Entregables</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="total-users">0</div>
                        <div class="stat-label lang" data-es="Usuarios" data-ca="Usuaris">Usuarios</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="total-roles">0</div>
                        <div class="stat-label lang" data-es="Roles" data-ca="Rols">Roles</div>
                    </div>
                </div>
                
                <h3 style="margin: 25px 0 15px; color: var(--primary);" class="lang" data-es="üèÜ Ranking de Usuarios por Valor Aportado" data-ca="üèÜ R√†nquing d'Usuaris per Valor Aportat">üèÜ Ranking de Usuarios por Valor Aportado</h3>
                <div class="ranking-container">
                    <div class="ranking-header">
                        <div class="lang" data-es="Pos" data-ca="Pos">Pos</div>
                        <div class="lang" data-es="Usuario" data-ca="Usuari">Usuario</div>
                        <div class="lang" data-es="Rol" data-ca="Rol">Rol</div>
                        <div class="lang" data-es="Wallet" data-ca="Wallet">Wallet</div>
                        <div class="lang" data-es="Valor" data-ca="Valor">Valor</div>
                    </div>
                    <div id="ranking-list">
                        <div class="empty-state">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <h3 class="lang" data-es="No hay entregables registrados a√∫n" data-ca="No hi ha entregables registrats encara">No hay entregables registrados a√∫n</h3>
                            <p class="lang" data-es="Importa tu mapa de valor o a√±ade el primer entregable para comenzar a construir tu contabilidad de valor" data-ca="Importa el teu mapa de valor o afegeix el primer entregable per comen√ßar a construir la teva comptabilitat de valor">Importa tu mapa de valor o a√±ade el primer entregable para comenzar a construir tu contabilidad de valor</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer>
        <div class="footer-grid">
            <div class="footer-col">
                <h3 class="lang" data-es="TeamTowers Hum√†" data-ca="TeamTowers Hum√†">TeamTowers Hum√†</h3>
                <p class="lang" data-es="De las torres humanas a las organizaciones humanas. Consultor√≠a estrat√©gica de RRHH con enfoque humanista desde Vilafranca del Pened√®s." data-ca="De les torres humanes a les organitzacions humanes. Consultoria estrat√®gica de RRHH amb enfocament humanista des de Vilafranca del Pened√®s.">De las torres humanas a las organizaciones humanas. Consultor√≠a estrat√©gica de RRHH con enfoque humanista desde Vilafranca del Pened√®s.</p>
            </div>
            <div class="footer-col">
                <h3 class="lang" data-es="Servicios" data-ca="Serveis">Servicios</h3>
                <ul class="footer-links">
                    <li><a href="https://teamtowershuma.com/" class="lang" data-es="TeamTowers" data-ca="TeamTowers">TeamTowers</a></li>
                    <li><a href="https://teamtowershuma.com/valor" class="lang" data-es="Value Network Analysis" data-ca="Value Network Analysis">Value Network Analysis</a></li>
                    <li><a href="https://teamtowershuma.com/coops" class="lang" data-es="Comunidades de Pr√°ctica" data-ca="Comunitats de Pr√†ctica">Comunidades de Pr√°ctica</a></li>
                    <li><a href="https://teamtowershuma.com/rrhh" class="lang" data-es="Business Partner RRHH" data-ca="Business Partner RRHH">Business Partner RRHH</a></li>
                    <li><a href="https://teamtowershuma.com/masia" class="lang" data-es="La Masia" data-ca="La Masia">La Masia</a></li>
                    <li><a href="https://teamtowershuma.com/sistema_integral" class="lang" data-es="Sistema Integral" data-ca="Sistema Integral">Sistema Integral</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3 class="lang" data-es="Apps" data-ca="Apps">Apps</h3>
                <ul class="footer-links">
                    <li><a href="https://teamtowershuma.com/app" class="lang" data-es="App VNA" data-ca="App VNA">App VNA</a></li>
                    <li><a href="https://teamtowershuma.com/app_comptabilitat" class="lang" data-es="App Contabilidad de Valor" data-ca="App Comptabilitat de Valor">App Contabilidad de Valor</a></li>
                    <li><a href="https://teamtowershuma.com/app_coops" class="lang" data-es="App Comunidades de Pr√°ctica" data-ca="App Comunitats de Pr√†ctica">App Comunidades de Pr√°ctica</a></li>
                    <li><a href="https://teamtowershuma.com/tokenomics" class="lang" data-es="App Tokenomics" data-ca="App Tokenomics">App Tokenomics</a></li>
                    <li><a href="https://cursovna.netlify.app/" target="_blank" class="lang" data-es="Curso de VNA" data-ca="Curs de VNA">Curso de VNA</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h3 class="lang" data-es="Contacto" data-ca="Contacte">Contacto</h3>
                <ul class="footer-links">
                    <li>Vilafranca del Pened√®s, Barcelona</li>
                    <li>+34 629 86 77 15</li>
                    <li>
                        <a href="mailto:asolache@mac.com" style="color: var(--accent); font-weight: 600;">
                            <span class="lang" data-es="Enviar mensaje" data-ca="Enviar missatge">Enviar mensaje</span>
                        </a>
                    </li>
                    <li>
                        <a href="https://linkedin.com/in/alvarosolache" target="_blank" style="color: var(--accent); font-weight: 600;">LinkedIn</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="copyright">
            <p class="lang" data-es="¬© 2026 TeamTowers Hum√†. Todos los derechos reservados. Sistema de Contabilidad de Valor con preparaci√≥n para tokenizaci√≥n futura de contribuciones." data-ca="¬© 2026 TeamTowers Hum√†. Tots els drets reservats. Sistema de Comptabilitat de Valor amb preparaci√≥ per tokenitzaci√≥ futura de contribucions.">¬© 2026 TeamTowers Hum√†. Todos los derechos reservados. Sistema de Contabilidad de Valor con preparaci√≥n para tokenizaci√≥n futura de contribuciones.</p>
        </div>
    </footer>
    
    <script>
        // Estado de la aplicaci√≥n
        let projectData = {
            name: "Proyecto sin nombre",
            currency: "puntos",
            roles: {}, // { roleName: { users: [{name, wallet}], deliverables: [] } }
            deliverables: [],
            vnaData: null
        };
        
        let valueChart = null;
        
        // Inicializaci√≥n cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar botones de idioma
            setupLanguageSelector();
            
            // Cargar datos guardados
            loadSavedData();
            
            // Inicializar gr√°fico
            initChart();
            
            // Configurar event listeners
            setupEventListeners();
            
            // Actualizar visualizaciones
            updateVisualizations();
            
            // Cargar roles en los selects
            loadRolesInSelects();
        });
        
        // Configurar selector de idioma
        function setupLanguageSelector() {
            const langButtons = document.querySelectorAll('.lang-btn');
            const translatableElements = document.querySelectorAll('[data-es], [data-ca]');
            
            // Establecer idioma inicial
            const userLang = navigator.language.startsWith('ca') ? 'ca' : 'es';
            setActiveLanguage(userLang);
            
            // Event listeners para botones de idioma
            langButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const selectedLang = this.getAttribute('data-lang');
                    setActiveLanguage(selectedLang);
                    
                    // Actualizar bot√≥n activo
                    langButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            function setActiveLanguage(lang) {
                translatableElements.forEach(element => {
                    if (element.hasAttribute(`data-${lang}`)) {
                        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                            element.placeholder = element.getAttribute(`data-${lang}`);
                        } else {
                            element.innerHTML = element.getAttribute(`data-${lang}`);
                        }
                    }
                });
                
                document.documentElement.setAttribute('lang', lang);
            }
        }
        
        // Configurar event listeners
        function setupEventListeners() {
            // Importar datos
            document.getElementById('import-data').addEventListener('click', importData);
            
            // A√±adir entregable r√°pido
            document.getElementById('quick-add').addEventListener('click', addQuickDeliverable);
            document.getElementById('quick-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addQuickDeliverable();
            });
            
            // A√±adir entregable detallado
            document.getElementById('add-deliverable').addEventListener('click', addDeliverable);
            
            // A√±adir usuario
            document.getElementById('add-user').addEventListener('click', addUser);
            
            // Exportar datos
            document.getElementById('export-json').addEventListener('click', exportJSON);
            document.getElementById('export-csv').addEventListener('click', exportCSV);
            
            // Limpiar datos
            document.getElementById('reset-data').addEventListener('click', resetData);
            
            // Cambiar moneda
            document.getElementById('value-currency').addEventListener('change', function() {
                projectData.currency = this.value;
                saveData();
                updateVisualizations();
            });
            
            // Cambiar nombre del proyecto
            document.getElementById('project-name').addEventListener('change', function() {
                projectData.name = this.value || "Proyecto sin nombre";
                saveData();
                updateVisualizations();
            });
            
            // Cuando se selecciona un rol, cargar usuarios de ese rol
            document.getElementById('role-select').addEventListener('change', function() {
                loadUsersInSelect(this.value);
            });
        }
        
        // Importar datos desde archivo JSON
        function importData() {
            const fileInput = document.getElementById('import-file');
            const file = fileInput.files[0];
            
            if (!file) {
                alert(document.documentElement.lang === 'ca' ? 
                    'Selecciona un archivo JSON primero' : 
                    'Selecciona un archivo JSON primero');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Validar estructura b√°sica
                    if (!importedData.nodes || !importedData.links) {
                        throw new Error('El archivo no tiene la estructura correcta (nodes y links)');
                    }
                    
                    // Guardar datos VNA
                    projectData.vnaData = importedData;
                    
                    // Procesar nodos como roles
                    importedData.nodes.forEach(node => {
                        const roleName = node.id.toLowerCase();
                        if (!projectData.roles[roleName]) {
                            projectData.roles[roleName] = {
                                name: node.id,
                                users: [],
                                deliverables: []
                            };
                        }
                    });
                    
                    // Procesar enlaces como transacciones
                    importedData.links.forEach(link => {
                        const source = typeof link.source === 'object' ? link.source.id : link.source;
                        const target = typeof link.target === 'object' ? link.target.id : link.target;
                        const deliverable = link.deliverable || 'Entregable importado';
                        
                        // A√±adir entregable de ejemplo
                        projectData.deliverables.push({
                            id: Date.now() + Math.random().toString(36).substr(2, 5),
                            role: source.toLowerCase(),
                            deliverable: deliverable,
                            description: `Transacci√≥n importada: ${source} ‚Üí ${target}`,
                            link: '',
                            value: 100, // Valor por defecto
                            timestamp: new Date().toISOString()
                        });
                    });
                    
                    saveData();
                    updateVisualizations();
                    loadRolesInSelects();
                    
                    // Mostrar secci√≥n de asignaci√≥n de usuarios
                    document.getElementById('role-user-assignment').style.display = 'block';
                    loadRolesForAssignment();
                    
                    alert(document.documentElement.lang === 'ca' ? 
                        'Mapa de valor importado correctamente! Ahora asigna usuarios a cada rol.' : 
                        'Mapa de valor importado correctamente! Ahora asigna usuarios a cada rol.');
                } catch (error) {
                    console.error('Error al importar datos:', error);
                    alert(document.documentElement.lang === 'ca' ? 
                        `Error en importar les dades: ${error.message}` : 
                        `Error al importar los datos: ${error.message}`);
                }
            };
            
            reader.readAsText(file);
        }
        
        // Cargar roles para asignaci√≥n de usuarios
        function loadRolesForAssignment() {
            const container = document.getElementById('roles-container');
            container.innerHTML = '';
            
            Object.keys(projectData.roles).forEach(roleName => {
                const role = projectData.roles[roleName];
                
                const roleDiv = document.createElement('div');
                roleDiv.className = 'user-card';
                roleDiv.innerHTML = `
                    <h4>${role.name}</h4>
                    <p><small class="lang" data-es="Usuarios asignados:" data-ca="Usuaris assignats:">Usuarios asignados:</small> ${role.users.length}</p>
                    <div style="margin-top: 10px;">
                        <input type="text" placeholder="${document.documentElement.lang === 'ca' ? 'Nom d\'usuari' : 'Nombre de usuario'}" class="user-name-input" data-role="${roleName}">
                        <input type="text" placeholder="0x..." class="user-wallet-input" data-role="${roleName}" style="margin-top: 5px; font-family: monospace; font-size: 0.85rem;">
                        <button class="btn btn-success add-user-to-role" style="margin-top: 8px; padding: 6px 12px; font-size: 0.9rem;" data-role="${roleName}">
                            <span>üë§</span> ${document.documentElement.lang === 'ca' ? 'Afegir' : 'A√±adir'}
                        </button>
                    </div>
                `;
                
                container.appendChild(roleDiv);
            });
            
            // A√±adir event listeners a los botones
            document.querySelectorAll('.add-user-to-role').forEach(button => {
                button.addEventListener('click', function() {
                    const roleName = this.getAttribute('data-role');
                    const nameInput = this.parentElement.querySelector('.user-name-input');
                    const walletInput = this.parentElement.querySelector('.user-wallet-input');
                    
                    const userName = nameInput.value.trim();
                    const userWallet = walletInput.value.trim();
                    
                    if (!userName) {
                        alert(document.documentElement.lang === 'ca' ? 
                            'Introdueix un nom d\'usuari' : 
                            'Introduce un nombre de usuario');
                        return;
                    }
                    
                    // A√±adir usuario al rol
                    if (!projectData.roles[roleName]) {
                        projectData.roles[roleName] = { name: roleName, users: [], deliverables: [] };
                    }
                    
                    projectData.roles[roleName].users.push({
                        name: userName,
                        wallet: userWallet || null
                    });
                    
                    saveData();
                    loadRolesForAssignment();
                    loadRolesInSelects();
                    
                    // Limpiar inputs
                    nameInput.value = '';
                    walletInput.value = '';
                    
                    alert(document.documentElement.lang === 'ca' ? 
                        `Usuari ${userName} afegit al rol ${roleName}` : 
                        `Usuario ${userName} a√±adido al rol ${roleName}`);
                });
            });
        }
        
        // A√±adir entregable r√°pido
        function addQuickDeliverable() {
            const input = document.getElementById('quick-input').value.trim();
            if (!input) return;
            
            // Parsear formato: @rol #entregable valor:100
            const roleMatch = input.match(/@(\S+)/);
            const deliverableMatch = input.match(/#(\S+)/);
            const valueMatch = input.match(/valor:(\d+)/i);
            
            if (!roleMatch || !deliverableMatch || !valueMatch) {
                alert(document.documentElement.lang === 'ca' ? 
                    'Format incorrecte. Usa: @rol #entregable valor:100' : 
                    'Formato incorrecto. Usa: @rol #entregable valor:100');
                return;
            }
            
            const role = roleMatch[1].toLowerCase();
            const deliverable = deliverableMatch[1];
            const value = parseInt(valueMatch[1]);
            
            // Obtener primer usuario del rol (o crear uno por defecto)
            let userName = 'Usuario';
            let userWallet = null;
            
            if (projectData.roles[role] && projectData.roles[role].users.length > 0) {
                const firstUser = projectData.roles[role].users[0];
                userName = firstUser.name;
                userWallet = firstUser.wallet;
            }
            
            addDeliverableToSystem(role, userName, userWallet, deliverable, `Entregable r√°pido: ${deliverable}`, '', value);
            
            // Limpiar input
            document.getElementById('quick-input').value = '';
        }
        
        // A√±adir entregable detallado
        function addDeliverable() {
            const roleSelect = document.getElementById('role-select');
            const userSelect = document.getElementById('user-select');
            const deliverableInput = document.getElementById('deliverable-input').value.trim();
            const descriptionInput = document.getElementById('description-input').value.trim();
            const linkInput = document.getElementById('link-input').value.trim();
            const valueInput = document.getElementById('value-input').value.trim();
            
            if (!roleSelect.value || !userSelect.value || !deliverableInput || !valueInput) {
                alert(document.documentElement.lang === 'ca' ? 
                    'Omple tots els camps obligatoris (rol, usuari, entregable, valor)' : 
                    'Completa todos los campos obligatorios (rol, usuario, entregable, valor)');
                return;
            }
            
            const role = roleSelect.value;
            const userName = userSelect.options[userSelect.selectedIndex].text;
            const userId = userSelect.value;
            
            // Obtener wallet del usuario
            let userWallet = null;
            if (projectData.roles[role] && projectData.roles[role].users) {
                const user = projectData.roles[role].users.find(u => `${u.name}|${u.wallet || ''}` === userId);
                if (user) userWallet = user.wallet;
            }
            
            const value = parseInt(valueInput);
            
            addDeliverableToSystem(role, userName, userWallet, deliverableInput, descriptionInput, linkInput, value);
            
            // Limpiar formulario
            document.getElementById('deliverable-input').value = '';
            document.getElementById('description-input').value = '';
            document.getElementById('link-input').value = '';
            document.getElementById('value-input').value = '';
            
            // Feedback al usuario
            const successMsg = document.documentElement.lang === 'ca' ? 
                `Entregable registrat per ${userName}` : 
                `Entregable registrado para ${userName}`;
            
            const btn = document.getElementById('add-deliverable');
            const originalText = btn.innerHTML;
            btn.innerHTML = `<span>‚úÖ</span> ${successMsg}`;
            btn.style.background = 'linear-gradient(135deg, #10b981 0%, #0da27f 100%)';
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.background = '';
            }, 2000);
        }
        
        // Funci√≥n central para a√±adir entregable
        function addDeliverableToSystem(role, userName, userWallet, deliverable, description, link, value) {
            // Asegurar que el rol exista
            if (!projectData.roles[role]) {
                projectData.roles[role] = {
                    name: role.charAt(0).toUpperCase() + role.slice(1),
                    users: [],
                    deliverables: []
                };
                
                // A√±adir usuario si no existe
                if (!projectData.roles[role].users.some(u => u.name === userName)) {
                    projectData.roles[role].users.push({
                        name: userName,
                        wallet: userWallet
                    });
                }
            }
            
            // Crear entregable
            const deliverableObj = {
                id: Date.now() + Math.random().toString(36).substr(2, 5),
                role: role,
                user: userName,
                wallet: userWallet,
                deliverable: deliverable,
                description: description,
                link: link,
                value: value,
                timestamp: new Date().toISOString()
            };
            
            // A√±adir a la lista de entregables
            projectData.deliverables.push(deliverableObj);
            
            // Guardar y actualizar
            saveData();
            updateVisualizations();
        }
        
        // A√±adir usuario
        function addUser() {
            const userName = document.getElementById('new-user-name').value.trim();
            const userWallet = document.getElementById('new-user-wallet').value.trim();
            const roleSelect = document.getElementById('new-user-role');
            const roleName = roleSelect.value;
            
            if (!userName || !roleName) {
                alert(document.documentElement.lang === 'ca' ? 
                    'Omple tots els camps obligatoris (nom d\'usuari, rol)' : 
                    'Completa todos los campos obligatorios (nombre de usuario, rol)');
                return;
            }
            
            // Asegurar que el rol exista
            if (!projectData.roles[roleName]) {
                projectData.roles[roleName] = {
                    name: roleName.charAt(0).toUpperCase() + roleName.slice(1),
                    users: [],
                    deliverables: []
                };
            }
            
            // A√±adir usuario al rol
            projectData.roles[roleName].users.push({
                name: userName,
                wallet: userWallet || null
            });
            
            saveData();
            updateVisualizations();
            loadRolesInSelects();
            
            // Limpiar formulario
            document.getElementById('new-user-name').value = '';
            document.getElementById('new-user-wallet').value = '';
            
            // Feedback al usuario
            const successMsg = document.documentElement.lang === 'ca' ? 
                `Usuari ${userName} afegit al rol ${roleName}` : 
                `Usuario ${userName} a√±adido al rol ${roleName}`;
            
            const btn = document.getElementById('add-user');
            const originalText = btn.innerHTML;
            btn.innerHTML = `<span>‚úÖ</span> ${successMsg}`;
            btn.style.background = 'linear-gradient(135deg, #10b981 0%, #0da27f 100%)';
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.background = '';
            }, 2000);
        }
        
        // Cargar roles en los selects
        function loadRolesInSelects() {
            const roleSelect = document.getElementById('role-select');
            const newUserRoleSelect = document.getElementById('new-user-role');
            
            // Limpiar opciones actuales (excepto la primera)
            while (roleSelect.options.length > 1) {
                roleSelect.remove(1);
            }
            
            while (newUserRoleSelect.options.length > 1) {
                newUserRoleSelect.remove(1);
            }
            
            // A√±adir roles
            Object.keys(projectData.roles).forEach(roleName => {
                const role = projectData.roles[roleName];
                
                const option1 = document.createElement('option');
                option1.value = roleName;
                option1.textContent = role.name;
                roleSelect.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = roleName;
                option2.textContent = role.name;
                newUserRoleSelect.appendChild(option2);
            });
            
            // Si hay roles, cargar usuarios del primer rol
            if (Object.keys(projectData.roles).length > 0) {
                loadUsersInSelect(Object.keys(projectData.roles)[0]);
            }
        }
        
        // Cargar usuarios en el select de usuarios
        function loadUsersInSelect(roleName) {
            const userSelect = document.getElementById('user-select');
            
            // Limpiar opciones actuales (excepto la primera)
            while (userSelect.options.length > 1) {
                userSelect.remove(1);
            }
            
            // Si no hay rol seleccionado, salir
            if (!roleName || !projectData.roles[roleName]) return;
            
            // A√±adir usuarios del rol
            projectData.roles[roleName].users.forEach(user => {
                const option = document.createElement('option');
                option.value = `${user.name}|${user.wallet || ''}`;
                option.textContent = user.name;
                userSelect.appendChild(option);
            });
            
            // Actualizar grid de usuarios
            updateUserGrid();
        }
        
        // Actualizar grid de usuarios
        function updateUserGrid() {
            const userGrid = document.getElementById('user-grid');
            userGrid.innerHTML = '';
            
            // Contar total de usuarios
            let totalUsers = 0;
            
            // Mostrar usuarios por rol
            Object.keys(projectData.roles).forEach(roleName => {
                const role = projectData.roles[roleName];
                
                role.users.forEach(user => {
                    totalUsers++;
                    
                    const userCard = document.createElement('div');
                    userCard.className = 'user-card';
                    userCard.innerHTML = `
                        <h4>${user.name}</h4>
                        <p><small class="role-tag role-team">${role.name}</small></p>
                        ${user.wallet ? `<p class="wallet">${user.wallet}</p>` : ''}
                    `;
                    userGrid.appendChild(userCard);
                });
            });
            
            // Actualizar estad√≠stica
            document.getElementById('total-users').textContent = totalUsers;
            document.getElementById('total-roles').textContent = Object.keys(projectData.roles).length;
        }
        
        // Inicializar gr√°fico
        function initChart() {
            const ctx = document.getElementById('valueChart').getContext('2d');
            valueChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            'rgba(79, 70, 229, 0.85)',
                            'rgba(16, 185, 129, 0.85)',
                            'rgba(245, 158, 11, 0.85)',
                            'rgba(59, 130, 246, 0.85)',
                            'rgba(139, 92, 246, 0.85)',
                            'rgba(22, 163, 74, 0.85)',
                            'rgba(168, 85, 247, 0.85)',
                            'rgba(37, 99, 235, 0.85)'
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                                    
                                    return `${label}: ${percentage}% (${Math.round(value).toLocaleString()} puntos)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true
                    }
                }
            });
        }
        
        // Actualizar visualizaciones
        function updateVisualizations() {
            // Actualizar estad√≠sticas
            const totalValue = projectData.deliverables.reduce((sum, d) => sum + d.value, 0);
            const totalDeliverables = projectData.deliverables.length;
            
            document.getElementById('total-value').textContent = totalValue.toLocaleString();
            document.getElementById('total-deliverables').textContent = totalDeliverables;
            
            // Actualizar gr√°fico
            updateChart();
            
            // Actualizar ranking
            updateRanking();
        }
        
        // Actualizar gr√°fico
        function updateChart() {
            if (!valueChart) return;
            
            // Calcular valor total por rol
            const roleValues = {};
            projectData.deliverables.forEach(deliverable => {
                const role = deliverable.role;
                roleValues[role] = (roleValues[role] || 0) + deliverable.value;
            });
            
            // Preparar datos para el gr√°fico
            const labels = Object.keys(roleValues);
            const data = Object.values(roleValues);
            
            // Actualizar gr√°fico
            valueChart.data.labels = labels;
            valueChart.data.datasets[0].data = data;
            valueChart.update();
        }
        
        // Actualizar ranking
        function updateRanking() {
            const rankingList = document.getElementById('ranking-list');
            
            if (projectData.deliverables.length === 0) {
                rankingList.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <h3 class="lang" data-es="No hay entregables registrados a√∫n" data-ca="No hi ha entregables registrats encara">No hay entregables registrados a√∫n</h3>
                        <p class="lang" data-es="Importa tu mapa de valor o a√±ade el primer entregable para comenzar a construir tu contabilidad de valor" data-ca="Importa el teu mapa de valor o afegeix el primer entregable per comen√ßar a construir la teva comptabilitat de valor">Importa tu mapa de valor o a√±ade el primer entregable para comenzar a construir tu contabilidad de valor</p>
                    </div>
                `;
                return;
            }
            
            // Calcular valor total por usuario
            const userValues = {};
            projectData.deliverables.forEach(deliverable => {
                const userKey = `${deliverable.user}|${deliverable.role}`;
                if (!userValues[userKey]) {
                    userValues[userKey] = {
                        name: deliverable.user,
                        role: deliverable.role,
                        wallet: deliverable.wallet,
                        totalValue: 0
                    };
                }
                userValues[userKey].totalValue += deliverable.value;
            });
            
            // Convertir a array y ordenar
            const usersArray = Object.values(userValues).sort((a, b) => b.totalValue - a.totalValue);
            
            // Generar HTML para el ranking
            let html = '';
            usersArray.forEach((user, index) => {
                const position = index + 1;
                const role = projectData.roles[user.role] ? projectData.roles[user.role].name : user.role;
                
                html += `
                    <div class="ranking-item">
                        <div class="ranking-badge">${position}</div>
                        <div>
                            <strong>${user.name}</strong><br>
                            <span class="role-tag role-team">${role}</span>
                        </div>
                        <div>
                            ${user.wallet ? `<div class="wallet-address">${user.wallet.substring(0, 6)}...${user.wallet.substring(user.wallet.length - 4)}</div>` : '<span class="lang" data-es="Sin wallet" data-ca="Sense wallet">Sin wallet</span>'}
                        </div>
                        <div class="wallet-address">
                            ${user.wallet || '-'}
                        </div>
                        <div class="value-amount">${user.totalValue.toLocaleString()}</div>
                    </div>
                `;
            });
            
            rankingList.innerHTML = html;
        }
        
        // Exportar como JSON
        function exportJSON() {
            const dataStr = JSON.stringify(projectData, null, 2);
            const blob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            
            const exportFileDefaultName = `value-accounting-${projectData.name.replace(/\s+/g, '-').toLowerCase()}-${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', url);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.style.display = 'none';
            document.body.appendChild(linkElement);
            
            linkElement.click();
            
            // Limpiar el objeto URL despu√©s de la descarga
            setTimeout(() => {
                document.body.removeChild(linkElement);
                URL.revokeObjectURL(url);
            }, 100);
            
            alert(document.documentElement.lang === 'ca' ? 
                'Dades exportades correctament com a JSON' : 
                'Datos exportados correctamente como JSON');
        }
        
        // Exportar como CSV
        function exportCSV() {
            // Cabeceras
            let csv = 'Rol,Usuario,Wallet,Entregable,Descripci√≥n,Enlace,Valor,Fecha\n';
            
            // Datos
            projectData.deliverables.forEach(d => {
                csv += `"${d.role}","${d.user}","${d.wallet || ''}","${d.deliverable}","${d.description.replace(/"/g, '""')}","${d.link}",${d.value},"${new Date(d.timestamp).toLocaleDateString()}"\n`;
            });
            
            const blob = new Blob([csv], {type: 'text/csv'});
            const url = URL.createObjectURL(blob);
            
            const exportFileDefaultName = `value-accounting-${projectData.name.replace(/\s+/g, '-').toLowerCase()}-${new Date().toISOString().slice(0,10)}.csv`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', url);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.style.display = 'none';
            document.body.appendChild(linkElement);
            
            linkElement.click();
            
            // Limpiar el objeto URL despu√©s de la descarga
            setTimeout(() => {
                document.body.removeChild(linkElement);
                URL.revokeObjectURL(url);
            }, 100);
            
            alert(document.documentElement.lang === 'ca' ? 
                'Dades exportades correctament com a CSV' : 
                'Datos exportados correctamente como CSV');
        }
        
        // Limpiar datos
        function resetData() {
            if (confirm(document.documentElement.lang === 'ca' ? 
                'Est√†s segur que vols esborrar totes les dades del projecte?' : 
                '¬øEst√°s seguro de que quieres borrar todos los datos del proyecto?')) {
                
                projectData = {
                    name: "Proyecto sin nombre",
                    currency: "puntos",
                    roles: {},
                    deliverables: [],
                    vnaData: null
                };
                
                saveData();
                updateVisualizations();
                loadRolesInSelects();
                updateUserGrid();
                
                // Limpiar campos de formulario
                document.getElementById('project-name').value = "Proyecto sin nombre";
                document.getElementById('quick-input').value = '';
                document.getElementById('deliverable-input').value = '';
                document.getElementById('description-input').value = '';
                document.getElementById('link-input').value = '';
                document.getElementById('value-input').value = '';
                document.getElementById('new-user-name').value = '';
                document.getElementById('new-user-wallet').value = '';
                
                // Ocultar secci√≥n de asignaci√≥n
                document.getElementById('role-user-assignment').style.display = 'none';
                
                alert(document.documentElement.lang === 'ca' ? 
                    'Dades esborrades correctament' : 
                    'Datos borrados correctamente');
            }
        }
        
        // Guardar datos en localStorage
        function saveData() {
            localStorage.setItem('valueAccountingData', JSON.stringify(projectData));
        }
        
        // Cargar datos de localStorage
        function loadSavedData() {
            const saved = localStorage.getItem('valueAccountingData');
            if (saved) {
                const parsedData = JSON.parse(saved);
                
                projectData = {
                    name: parsedData.name || "Proyecto sin nombre",
                    currency: parsedData.currency || "puntos",
                    roles: parsedData.roles || {},
                    deliverables: parsedData.deliverables || [],
                    vnaData: parsedData.vnaData || null
                };
                
                // Restaurar nombre del proyecto en el input
                document.getElementById('project-name').value = projectData.name;
                document.getElementById('value-currency').value = projectData.currency;
                
                // Cargar roles en selects
                loadRolesInSelects();
                
                // Actualizar grid de usuarios
                updateUserGrid();
            }
        }
    </script>
</body>
</html>
